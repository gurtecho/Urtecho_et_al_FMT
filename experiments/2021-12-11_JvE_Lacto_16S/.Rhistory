# filter tidy otu to only look at species at >= .1% relative abundance
species.to.keep <- tidy.otu %>%
group_by(family, genus, species) %>%
summarize(mean_rel_abd = mean(rel_abd), .groups = "drop") %>%
filter(mean_rel_abd > .1) %>%
select(species) %>%
as_vector()
tidy.otu <- tidy.otu %>%
filter(species %in% species.to.keep)
# Look at rumino abd
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
group_by(genus, species) %>%
summarize(mean_rel_abd = mean(rel_abd), .groups = "drop")
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(log10_rel_abd), binwidth = 0.25)
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes((..log10_rel_abd..)/sum(..log10_rel_abd..)), binwidth = 0.25)
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(x = log10_rel_abd, y = (..count..)/sum(..count..)), binwidth = 0.25)
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(x = log10_rel_abd, y = (..count..)/sum(..count..)), binwidth = 0.25)
#hmp2012 <- curatedMetagenomicData("HMP_2012.relative_abundance", dryrun = FALSE)[[1]]
zeevi2015 <- curatedMetagenomicData("ZeeviD_2015.relative_abundance", dryrun = FALSE)[[1]]
# Pull out pseudo-OTU table
otu <- assays(hmp2012)[[1]]
# Pull taxonomy info from table
taxonomy <- rownames(otu) %>%
as_tibble() %>%
rename(tax = value) %>%
separate(tax, into = c("k", "p", "c", "o", "family", "genus", "species"), sep = "([|])") %>%
select(family, genus, species)
# Convert to tibble; end up losing tax column, add it back in w/ bind_columns
otu <- as_tibble(otu) %>%
bind_cols(taxonomy)
# Create tidy otu table
tidy.otu <- otu %>%
pivot_longer(!c(family, genus, species), names_to = "sample", values_to = "rel_abd") %>%
mutate(log10_rel_abd = if_else(rel_abd > 0, log10(rel_abd), -5))
# filter tidy otu to only look at species at >= .1% relative abundance
species.to.keep <- tidy.otu %>%
group_by(family, genus, species) %>%
summarize(mean_rel_abd = mean(rel_abd), .groups = "drop") %>%
filter(mean_rel_abd > .1) %>%
select(species) %>%
as_vector()
tidy.otu <- tidy.otu %>%
filter(species %in% species.to.keep)
# Look at rumino abd
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
group_by(genus, species) %>%
summarize(mean_rel_abd = mean(rel_abd), .groups = "drop")
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(x = log10_rel_abd, y = (..count..)/sum(..count..)), binwidth = 0.25)
rm(list=ls())
#hmp2012 <- curatedMetagenomicData("HMP_2012.relative_abundance", dryrun = FALSE)[[1]]
zeevi2015 <- curatedMetagenomicData("ZeeviD_2015.relative_abundance", dryrun = FALSE)[[1]]
# Pull out pseudo-OTU table
#otu <- assays(hmp2012)[[1]]
otu <- assays(zeevi2015)[[1]]
# Pull taxonomy info from table
taxonomy <- rownames(otu) %>%
as_tibble() %>%
rename(tax = value) %>%
separate(tax, into = c("k", "p", "c", "o", "family", "genus", "species"), sep = "([|])") %>%
select(family, genus, species)
# Convert to tibble; end up losing tax column, add it back in w/ bind_columns
otu <- as_tibble(otu) %>%
bind_cols(taxonomy)
# Create tidy otu table
tidy.otu <- otu %>%
pivot_longer(!c(family, genus, species), names_to = "sample", values_to = "rel_abd") %>%
mutate(log10_rel_abd = if_else(rel_abd > 0, log10(rel_abd), -5))
# filter tidy otu to only look at species at >= .1% relative abundance
species.to.keep <- tidy.otu %>%
group_by(family, genus, species) %>%
summarize(mean_rel_abd = mean(rel_abd), .groups = "drop") %>%
filter(mean_rel_abd > .1) %>%
select(species) %>%
as_vector()
tidy.otu <- tidy.otu %>%
filter(species %in% species.to.keep)
# Look at rumino abd
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
group_by(genus, species) %>%
summarize(mean_rel_abd = mean(rel_abd), .groups = "drop")
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(x = log10_rel_abd, y = (..count..)/sum(..count..)), binwidth = 0.25)
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(x = log10_rel_abd, y = (..count..)/sum(..count..)), binwidth = 0.25) +
facet_grid(genus~.)
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(x = log10_rel_abd, y = (..count..)/sum(..count..)), binwidth = 0.25) +
facet_grid(genus~.) +
theme(strip.text.y = element_text(angle=90))
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(x = log10_rel_abd, y = (..count..)/sum(..count..)), binwidth = 0.25) +
facet_grid(genus~.) +
theme(strip.text.y = element_text(angle=0))
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(x = log10_rel_abd, y = (..count..)/sum(..count..)), binwidth = 0.25) +
facet_grid(genus~., scales = "free") +
theme(strip.text.y = element_text(angle=0))
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(x = log10_rel_abd, y = (..count..)/sum(..count..)), binwidth = 0.25) +
facet_grid(genus~.) +
theme(strip.text.y = element_text(angle=0))
# Look at rumino abd
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
group_by(genus, species) %>%
summarize(mean_rel_abd = mean(rel_abd), .groups = "drop")
# Look at distribution of individual Ruminococcaceae species log10 relative abundance
tidy.otu %>%
filter(species == "s__Agathobaculum_butyriciproducens") %>%
ggplot() +
geom_histogram(aes(x = log10_rel_abd, y = (..count..)/sum(..count..)), binwidth = 0.25) +
facet_grid(genus~.) +
theme(strip.text.y = element_text(angle=0))
library(tidyverse)
library(tidyverse)
# set wd to the experiment folder
setwd("~/Dropbox/projects/fmt/experiments/2021-12-11_JvE_Lacto_16S/")
# Load data sets
zotu <- read_csv("data/zotu.csv")
# Load data sets
zotu <- read_csv("data/zotu.csv")
tax <- read_csv("data/tax.csv")
meta <- read_csv("metadata/metadata.csv")
zotu
zotu %>%
pivot_longer(-seqid, names_to = "OTU", values_to = "count")
tidy.zotu <- zotu %>%
pivot_longer(-seqid, names_to = "ZOTU", values_to = "count")
tax
tax %>% select(OTU, family, genus)
tax %>%
select(OTU, family, genus) %>%
rename(ZOTU = OTU)
meta
meta %>%
select(-c("S3_R2_path"))
meta %>%
select(-c("S3_R1_path" ,"S3_R2_path"))
# Clean up meta
meta <- meta %>%
select(-c("S3_R1_path" ,"S3_R2_path"))
tidy.zotu %>%
left_join(meta) %>%
left_join(tax)
tidy.zotu %>%
left_join(meta)
tax
library(tidyverse)
# set wd to the experiment folder
setwd("~/Dropbox/projects/fmt/experiments/2021-12-11_JvE_Lacto_16S/")
# Load data sets
zotu <- read_csv("data/zotu.csv")
tax <- read_csv("data/tax.csv")
meta <- read_csv("metadata/metadata.csv")
# Covert zotu into tidy format
tidy.zotu <- zotu %>%
pivot_longer(-seqid, names_to = "ZOTU", values_to = "count")
# filter the tax table and limit to desired tax levels
filt.tax <- tax %>%
select(OTU, family, genus) %>%
rename(ZOTU = OTU)
# filter the metadata to desired columns
filt.meta <- meta %>%
select(-c("S3_R1_path" ,"S3_R2_path"))
tidy.zotu %>%
left_join(filtmeta)
tidy.zotu %>%
left_join(filt.meta)
tidy.zotu %>%
left_join(filt.meta) %>%
left_join(tax)
tidy.zotu %>%
left_join(filt.meta) %>%
left_join(filt.tax)
tidy.zotu <- tidy.zotu %>%
left_join(filt.meta) %>%
left_join(filt.tax)
tidy.zotu
# Load data sets
zotu <- read_csv("data/zotu.csv")
tax <- read_csv("data/tax.csv")
# Clean up env
rm(list =ls())
# set wd to the experiment folder
setwd("~/Dropbox/projects/fmt/experiments/2021-12-11_JvE_Lacto_16S/")
# Load data sets
zotu <- read_csv("data/zotu.csv")
tax <- read_csv("data/tax.csv")
meta <- read_csv("metadata/metadata.csv")
# Covert zotu into tidy format
tidy.zotu <- zotu %>%
pivot_longer(-seqid, names_to = "ZOTU", values_to = "count")
tidy.zotu
tax
tax %>%
filter(genus == "Sporosarcina")
tax %>%
filter(genus == "Sporosarcina") %>%
select(OTU)
tax %>%
filter(genus == "Sporosarcina") %>%
select(OTU) %>%
as_vector()
tax %>%
filter(genus == "Sporosarcina") %>%
select(OTU) %>%
as_list()
tax %>%
filter(genus == "Sporosarcina") %>%
select(OTU) %>%
as_vector()
spike.in <- tax %>%
filter(genus == "Sporosarcina") %>%
select(OTU) %>%
as_vector()
# Pull out spike-in strains
tidy.zotu %>%
filter(ZOTU %in% spike.in)
# Pull out spike-in strains
tidy.zotu %>%
filter(ZOTU %in% spike.in) %>%
group_by(seqid) %>%
summarise(spike_count = sum(count))
# Pull out spike-in strains
spike.count <- tidy.zotu %>%
filter(ZOTU %in% spike.in) %>%
group_by(seqid) %>%
summarise(spike_count = sum(count))
# Filter spike-in counts from the ZOTU table
tidy.zotu %>%
filter(!ZOTU %in% spike.in)
# Filter spike-in counts from the ZOTU table
tidy.zotu <- tidy.zotu %>%
filter(!ZOTU %in% spike.in)
# Compute relative abundance
tidy.zotu %>%
group_by(seqid) %>%
mutate(rel_ab = count / sum(count))
# Compute relative abundance
tidy.zotu <- tidy.zotu %>%
group_by(seqid) %>%
mutate(rel_ab = count / sum(count))
# Sanity check
tidy.zotu %>%
group_by(seqid) %>%
sum(rel_ab)
# Sanity check
tidy.zotu %>%
group_by(seqid) %>%
summarise(total_ab = sum(rel_ab))
# Add in sporo count
tidy.zotu
# Add in sporo count
tidy.zotu %>%
left_join(spike.count)
# Add in sporo count
tidy.zotu <- tidy.zotu %>%
left_join(spike.count)
# Add in sporo count
tidy.zotu <- tidy.zotu %>%
left_join(spike.count)
# filter the tax table and limit to desired tax levels
filt.tax <- tax %>%
select(OTU, family, genus) %>%
rename(ZOTU = OTU)
# filter the metadata to desired columns
filt.meta <- meta %>%
select(-c("S3_R1_path" ,"S3_R2_path"))
tidy.zotu <- tidy.zotu %>%
left_join(filt.meta) %>%
left_join(filt.tax)
tidy.zotu
tidy.zotu %>%
ggplot() +
geom_bar(aes(x = seqid, y = rel_ab))
tidy.zotu %>%
ggplot() +
geom_bar(aes(x = seqid, y = rel_ab), stat = "identity")
tidy.zotu %>%
ggplot() +
geom_bar(aes(x = seqid, y = rel_ab, fill = family), stat = "identity")
filt.tidy.zotu <- tidy.zotu %>%
filter(rel_ab >= .01)
filt.tidy.zotu %>%
ggplot() +
geom_bar(aes(x = seqid, y = rel_ab, fill = family), stat = "identity")
library(RColorBrewer)
filt.tidy.zotu %>%
ggplot() +
geom_bar(aes(x = seqid, y = rel_ab, fill = family), stat = "identity") +
scale_fill_brewer(pallete = "Accent")
filt.tidy.zotu %>%
ggplot() +
geom_bar(aes(x = seqid, y = rel_ab, fill = family), stat = "identity") +
scale_fill_brewer(palette = "Accent")
filt.tidy.zotu %>%
filter(family = "Lactobacillaceae")
filt.tidy.zotu %>%
filter(family == "Lactobacillaceae")
filt.tidy.zotu %>%
filter(family == "Lactobacillaceae") +
geom_bar(aes(x = seqid, y = rel_ab, fill = genus), stat = "identity") +
scale_fill_brewer(palette = "Accent")
filt.tidy.zotu %>%
filter(family == "Lactobacillaceae") %>%
ggplot() +
geom_bar(aes(x = seqid, y = rel_ab, fill = genus), stat = "identity") +
scale_fill_brewer(palette = "Accent")
filt.tidy.zotu %>%
filter(family == "Lactobacillaceae") %>%
group_by(seqid)
filt.tidy.zotu %>%
ggplot() +
geom_bar(aes(x = seqid, y = rel_ab, fill = family), stat = "identity") +
scale_fill_brewer(palette = "Accent")
filt.tidy.zotu %>%
ggplot() +
geom_bar(aes(x = seqid, y = rel_ab, fill = family), stat = "identity")
# Clean up env
rm(list =ls())
# set wd to the experiment folder
setwd("~/Dropbox/projects/fmt/experiments/2021-12-11_JvE_Lacto_16S/")
# Load data sets
zotu <- read_csv("data/zotu.csv")
tax <- read_csv("data/tax.csv")
meta <- read_csv("metadata/metadata.csv")
# Covert zotu into tidy format
tidy.zotu <- zotu %>%
pivot_longer(-seqid, names_to = "ZOTU", values_to = "count")
# Pull out list of spike in ZOTUs
spike.in <- tax %>%
filter(genus == "Sporosarcina") %>%
select(OTU) %>%
as_vector()
# Pull out spike-in strains and generate table with counts
spike.count <- tidy.zotu %>%
filter(ZOTU %in% spike.in) %>%
group_by(seqid) %>%
summarise(spike_count = sum(count))
# Filter spike-in counts from the ZOTU table
tidy.zotu <- tidy.zotu %>%
filter(!ZOTU %in% spike.in)
# Compute relative abundance
tidy.zotu <- tidy.zotu %>%
group_by(seqid) %>%
mutate(rel_ab = count / sum(count))
# Sanity check
tidy.zotu %>%
group_by(seqid) %>%
summarise(total_ab = sum(rel_ab))
# Add in sporo count
tidy.zotu <- tidy.zotu %>%
left_join(spike.count)
# filter the tax table and limit to desired tax levels
filt.tax <- tax %>%
select(OTU, order, family, genus) %>%
rename(ZOTU = OTU)
# filter the metadata to desired columns
filt.meta <- meta %>%
select(-c("S3_R1_path" ,"S3_R2_path"))
tidy.zotu <- tidy.zotu %>%
left_join(filt.meta) %>%
left_join(filt.tax)
filt.tidy.zotu <- tidy.zotu %>%
filter(rel_ab >= .01)
filt.tidy.zotu %>%
ggplot() +
geom_bar(aes(x = seqid, y = rel_ab, fill = family), stat = "identity")
filt.tidy.zotu %>%
ggplot() +
geom_bar(aes(x = seqid, y = rel_ab, fill = order), stat = "identity")
order.barplot <- filt.tidy.zotu %>%
ggplot() +
geom_bar(aes(x = seqid, y = rel_ab, fill = order), stat = "identity")
ggsave("./figures/order_barplot.png", order.barplot)
filt.tidy.zotu %>%
filter(family == "Lactobacillaceae") %>%
group_by(seqid)
filt.tidy.zotu %>%
filter(family == "Lactobacillaceae") %>%
ggplot() +
geom_bar(aes(x = seqid, y = rel_ab, fill = genus), stat = "identity") +
scale_fill_brewer(palette = "Accent")
filt.tidy.zotu %>%
filter(family == "Lactobacillaceae") %>%
ggplot() +
geom_bar(aes(x = seqid, y = rel_ab, fill = ZOTU), stat = "identity") +
scale_fill_brewer(palette = "Accent")
filt.tidy.zotu %>%
filter(family == "Lactobacillaceae") %>%
ggplot() +
geom_bar(aes(x = seqid, y = rel_ab, fill = ZOTU), stat = "identity") +
scale_fill_brewer(palette = "Accent") +
ggtitles("Relative Abundance of Lactobacillaceae ZOTUs")
filt.tidy.zotu %>%
filter(family == "Lactobacillaceae") %>%
ggplot() +
geom_bar(aes(x = seqid, y = rel_ab, fill = ZOTU), stat = "identity") +
scale_fill_brewer(palette = "Accent") +
ggtitle("Relative Abundance of Lactobacillaceae ZOTUs")
lacto.zotu.barplot <- filt.tidy.zotu %>%
filter(family == "Lactobacillaceae") %>%
ggplot() +
geom_bar(aes(x = seqid, y = rel_ab, fill = ZOTU), stat = "identity") +
scale_fill_brewer(palette = "Accent") +
ggtitle("Relative Abundance of Lactobacillaceae ZOTUs")
lacto.zotu.barplot
ggsave("./figures/lacto_zotu_barplot.png", lacto.zotu.barplot)
filt.tidy.zotu
filt.tidy.zotu %>%
filter(family == "Lactobacillaceae")
filt.tidy.zotu %>%
filter(family == "Lactobacillaceae")
filt.tidy.zotu %>%
filter(family == "Lactobacillaceae") %>%
write_csv("metadata/lacto_zotus.csv")
lacto.zotu.barplot <- filt.tidy.zotu %>%
filter(family == "Lactobacillaceae") %>%
ggplot() +
geom_bar(aes(x = seqid, y = rel_ab, fill = ZOTU), stat = "identity") +
facet_grid(.~mouse_type) %>%
scale_fill_brewer(palette = "Accent") +
ggtitle("Relative Abundance of Lactobacillaceae ZOTUs")
lacto.zotu.barplot
View(filt.tidy.zotu)
lacto.zotu.barplot <- filt.tidy.zotu %>%
filter(family == "Lactobacillaceae") %>%
ggplot() +
geom_bar(aes(x = seqid, y = rel_ab, fill = ZOTU), stat = "identity") +
facet_grid(.~mouse_type) +
scale_fill_brewer(palette = "Accent") +
ggtitle("Relative Abundance of Lactobacillaceae ZOTUs")
lacto.zotu.barplot
lacto.zotu.barplot <- filt.tidy.zotu %>%
filter(family == "Lactobacillaceae") %>%
ggplot() +
geom_bar(aes(x = seqid, y = rel_ab, fill = ZOTU), stat = "identity") +
facet_grid(.~mouse_type, space = "free") +
scale_fill_brewer(palette = "Accent") +
ggtitle("Relative Abundance of Lactobacillaceae ZOTUs")
lacto.zotu.barplot
lacto.zotu.barplot <- filt.tidy.zotu %>%
filter(family == "Lactobacillaceae") %>%
ggplot() +
geom_bar(aes(x = seqid, y = rel_ab, fill = ZOTU), stat = "identity") +
facet_grid(.~mouse_type, space = "free", scale = "free") +
scale_fill_brewer(palette = "Accent") +
ggtitle("Relative Abundance of Lactobacillaceae ZOTUs")
lacto.zotu.barplot
ggsave("./figures/lacto_zotu_barplot.png", lacto.zotu.barplot)
order.barplot <- filt.tidy.zotu %>%
ggplot() +
geom_bar(aes(x = seqid, y = rel_ab, fill = order), stat = "identity") +
facet_grid(.~mouse_type, space = "free", scale = "free")
order.barplot
ggsave("./figures/order_barplot.png", order.barplot)
lacto.zotu.barplot <- filt.tidy.zotu %>%
filter(family == "Lactobacillaceae") %>%
ggplot() +
geom_bar(aes(x = seqid, y = rel_ab, fill = ZOTU), stat = "identity") +
facet_grid(.~mouse_type, space = "free", scale = "free") +
scale_fill_brewer(palette = "Accent") +
ggtitle("Relative Abundance of Lactobacillaceae ZOTUs")
lacto.zotu.barplot
ggsave("./figures/lacto_zotu_barplot.png", lacto.zotu.barplot)
filt.tidy.zotu %>%
filter(family == "Lactobacillaceae") %>%
write_csv("metadata/lacto_zotus.csv")
filt.tidy.zotu %>%
filter(family == "Lactobacillaceae") %>%
write_csv("metadata/lacto_zotus.csv")
