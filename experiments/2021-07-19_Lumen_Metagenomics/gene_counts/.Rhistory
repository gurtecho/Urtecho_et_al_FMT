LEFT JOIN Ecoli_operons AS b
ON a.tss_position BETWEEN b.upstream_left AND b.upstream_right") %>%
na.omit() %>%
filter(tss_strand == strand) %>% select(-fill, -genome, -upstream_left, -upstream_right)
scanning_mutagenesis <- mutagenesis_data %>%
select(name, tss_name, tss_position, strand, scramble_start,
scramble_end, prom_left_position = var_left, prom_right_position = var_right,
scramble_start_pos, scramble_end_pos, scramble_pos_rel_tss, expn_med_fitted, unscrambled_exp, relative_exp, num_barcodes_integrated, category, active)
operons_with_tss <- tss_gene_info %>% filter(active == 'active') %>% group_by(operon) %>% mutate(num_tss = n()) %>% ungroup() %>% select(operon, num_tss) %>% distinct()
#write-out tables
#Info on what TSSs regulate what genes
#write.table(tss_gene_info, "../../ref/tss_operon_regulation.txt", quote = F, row.names = F, sep = '\t')
#Info on mutagenesis data
#write.table(scanning_mutagenesis, "../../ref/scanning_mutagenesis_data.txt", quote = F, row.names = F, sep = '\t')
#Pick operon to study from this list
operons_with_tss <- read.table("OperonsWithTSS.txt", header = T)
View(operons_with_tss)
knitr::opts_chunk$set(echo = TRUE)
setwd('~/Google Drive/WangLab/Projects/RecodingProject/')
knitr::opts_knit$set('~/Google Drive/WangLab/Projects/RecodingProject/')
library(tidyverse)
library(ggthemes)
library(gt)
library(cowplot)
library(stringr)
library("readxl")
#library(Biostrings)
RecodedGene_stats <- read_excel("E.coli_ESS_HEG_list.xlsx", sheet = 1) %>%
rename(length = lengh) %>%
mutate(full_length = length + 126)
RecodedGene_seqs <- read_excel("E.coli_ESS_HEG_list.xlsx", sheet = 2)
#126 bp of sequence needed added to facilitate dropsynth/cloning
p1 <- RecodedGene_stats %>%
ggplot(aes(full_length)) +
geom_histogram(color = 'black') +
scale_y_log10() +
labs(x = 'Length of Genes',
y = 'Cont',
color = '') +
theme_clean() +
theme(axis.text.x = element_text(size = 24),
axis.text.y = element_text(size = 24),
axis.title.x.bottom = element_text(size = 24),
axis.title.y.left = element_text(size = 24), legend.position = 'none')
knitr::opts_chunk$set(echo = TRUE)
setwd('~/Google Drive/WangLab/Projects/RecodingProject/')
knitr::opts_knit$set('~/Google Drive/WangLab/Projects/RecodingProject/')
library(tidyverse)
library(ggthemes)
library(gt)
library(cowplot)
library(stringr)
library("readxl")
#library(Biostrings)
RecodedGene_stats <- read_excel("E.coli_ESS_HEG_list.xlsx", sheet = 1) %>%
rename(length = lengh) %>%
mutate(full_length = length + 126)
RecodedGene_seqs <- read_excel("E.coli_ESS_HEG_list.xlsx", sheet = 2)
#126 bp of sequence needed added to facilitate dropsynth/cloning
p1 <- RecodedGene_stats %>%
ggplot(aes(full_length)) +
geom_histogram(color = 'black') +
scale_y_log10() +
labs(x = 'Length of Genes',
y = 'Cont',
color = '') +
theme_clean() +
theme(axis.text.x = element_text(size = 24),
axis.text.y = element_text(size = 24),
axis.title.x.bottom = element_text(size = 24),
axis.title.y.left = element_text(size = 24), legend.position = 'none')
a<-as.data.frame(matrix(nrow=1, ncol = 2))
names(a) <- c('size', 'count')
for (i in seq(2000,100,-50)) {
temp <-  RecodedGene_stats %>%
select(full_length) %>%
filter(full_length <= i) %>%
mutate(count = n(), size = i) %>%
ungroup() %>%
select(size, count) %>% distinct()
a <- rbind(a,temp)
}
p2 <- ggplot(na.omit(a), aes(size, count)) +
# geom_hline(yintercept = c(384), linetype = 'dashed', color = 'red') +
geom_vline(xintercept = c(1021,1231, 811, 601),
linetype = 'dashed',
color = 'dodgerblue') +
annotate('text', x = 940, y = 350, label = '5 oligo') +
annotate('text', x = 1150, y = 400, label = '6 oligo') +
annotate('text', x = 750, y = 300, label = '4 oligo') +
annotate('text', x = 600, y = 250, label = '3 oligo') +
geom_point(size = 4) +
geom_line() +
scale_x_reverse(breaks = c(seq(2000,100,-250))) +
labs(x = 'Max Gene Length (bp)',
y = 'Numer of Genes',
color = '',
title = "Library Size with Length Threshold (by type)") +
theme_clean() +
theme(axis.text.x = element_text(size = 24, angle = 45, hjust = 1),
axis.text.y = element_text(size = 24),
axis.title.x.bottom = element_text(size = 24),
axis.title.y.left = element_text(size = 24), legend.position = 'none')
plot_grid(p1,p2)
ggsave("RecodedGeneLengths.png", width = 12, height = 6)
library(dplyr)
library(tidyr)
library(purrr)
library(ggplot2)
library(cowplot)
library(plotrix)
options(stringsAsFactors = F)
options(scipen = 10000)
args <- c('../processed_data/endo_scramble',
'../processed_data/endo_scramble/endo_scramble_combined_bc_map.txt',
'../processed_data/endo_scramble/endo_scramble_combined_controls_bc_map.txt',
'../processed_data/endo_scramble/endo_scramble_expression_formatted_std.txt')
count_folder <- args[1]
bc_map_file <- args[2]
bc_map_file_controls <- args[3]
formatted_file <- args[4]
# read in barcode count files
filelist = list.files(path = count_folder,
pattern = '^counts_*',
full.names = T)
# should be named so files are in following order, 1st number is biological replicate
# and second number is technical replicate
sample_names <- c('DNA1_1', 'DNA1_2', 'DNA2_1', 'DNA2_2', 'RNA1_1', 'RNA1_2', 'RNA2_1', 'RNA2_2')
for(i in seq(1:length(filelist))) {
sample_name <- sample_names[i]
x <- read.table(filelist[i], col.names=c(sample_name, 'barcode'), header = F)
x[[sample_name]] <- 1000000*x[[sample_name]]/sum(x[[sample_name]])  #Normalizes by RPM
assign(sample_name, x)
}
count_list <- list(DNA1_1, DNA1_2, DNA2_1, DNA2_2, RNA1_1, RNA1_2, RNA2_1, RNA2_2)
# combine reads for all barcodes
# feed list into reduce to full join entire list of data frames
all_counts <- count_list %>% purrr::reduce(full_join, by = "barcode")
print(paste("Number of unique sequenced barcodes, all replicates in DNA and RNA:", nrow(all_counts)))
# rearrange columns
all_counts <- select(all_counts, barcode, DNA1_1, DNA1_2:RNA2_2)
# remove individual sample files
rm(count_list, x)
rm(list = sample_names)
# read in mapping files
bc_map <- read.table(bc_map_file, header = F, sep = ',',
col.names = c('barcode', 'variant', 'count'))
# read in formatted file so we can label mapping file
data <- read.table(formatted_file, header = T)
bc_map <- bc_map %>%
left_join(select(data, name, variant), by = 'variant')
# add in positive controls
bc_map_controls <- read.table(bc_map_file_controls, header = T,
col.names = c('barcode', 'num_unique_variant', 'count',
'count_most_common', 'variant', 'name'))
bc_map <- bind_rows(bc_map, select(bc_map_controls, barcode, variant, count, name))
print(paste("Number of barcodes in mapping run:", nrow(bc_map)))
# only keep those that match reference
bc_map <- filter(bc_map, !is.na(name))
print(paste("Number of barcodes in mapping run and mapped to reference:", nrow(bc_map)))
# only keep barcode counts for mapped barcodes
mapped_bc_counts <- inner_join(bc_map, all_counts, by = 'barcode')
# replace NA with 0
mapped_bc_counts[is.na(mapped_bc_counts)] <- 0
print(paste("Number of mapped and sequenced barcodes, all replicates in DNA and RNA:", nrow(mapped_bc_counts)))
mapped_bc_counts <- left_join(mapped_bc_counts,
select(data, tss_name:scramble_pos_rel_tss,
variant, category), by = 'variant')
mapped_bc_counts_melt <- mapped_bc_counts %>%
mutate(expn_1_1 = RNA1_1 / DNA1_1,
expn_1_2 = RNA1_2 / DNA1_2,
expn_2_1 = RNA2_1 / DNA2_1,
expn_2_2 = RNA2_2 / DNA2_2) %>%
select(name, tss_name, category, expn_1_1:expn_2_2) %>%
reshape2::melt(id = c('name', 'tss_name', 'category'), value.name = 'expn')
scrambled_bcs <- mapped_bc_counts_melt %>%
filter(category == 'scramble')
unscrambled_bcs <- mapped_bc_counts_melt %>%
filter(category == 'unscrambled')
ttest_custom <- function(df, df_wt) {
wt_name <- df$tss_name[1]
# bind unscrambled barcodes to df
df_with_wt <- bind_rows(df,
filter(df_wt, tss_name == wt_name)) %>%
mutate(category_fctr = factor(category)) %>%
filter(!is.na(expn), is.finite(expn))
result <- tryCatch(
{
t.test(expn ~ category_fctr, df_with_wt)
}, warning = function(cond) {
return(NA)
}, error = function(cond) {
return(NA)
}
)
return(result)
}
# test <- filter(scrambled_bcs, name == 'TSS_10266_regulondb,2723831,-_scrambled5-15_flipped_rc')
scramble_ttests <- scrambled_bcs %>%
group_by(name, tss_name) %>%
do(ttest = ttest_custom(., df_wt = unscrambled_bcs)) %>%
broom::tidy(ttest) %>%
ungroup()
View(scrambled_bcs)
ttest_custom <- function(df, df_wt) {
wt_name <- df$tss_name[1]
# bind unscrambled barcodes to df
df_with_wt <- bind_rows(df,
filter(df_wt, tss_name == wt_name)) %>%
mutate(category_fctr = factor(category)) %>%
filter(!is.na(expn), is.finite(expn))
#result <- tryCatch(
{
#        t.test(expn ~ category_fctr, df_with_wt)
#    }, warning = function(cond) {
#        return(NA)
#    }, error = function(cond) {
#        return(NA)
#    }
#)
return(result)
}
# test <- filter(scrambled_bcs, name == 'TSS_10266_regulondb,2723831,-_scrambled5-15_flipped_rc')
scramble_ttests <- scrambled_bcs %>%
group_by(name, tss_name) %>%
do(ttest = ttest_custom(., df_wt = unscrambled_bcs)) %>%
broom::tidy(ttest) %>%
ungroup()
ttest_custom <- function(df, df_wt) {
wt_name <- df$tss_name[1]
# bind unscrambled barcodes to df
df_with_wt <- bind_rows(df,
filter(df_wt, tss_name == wt_name)) %>%
mutate(category_fctr = factor(category)) %>%
filter(!is.na(expn), is.finite(expn))
#result <- tryCatch(
{
#        t.test(expn ~ category_fctr, df_with_wt)
#    }, warning = function(cond) {
#        return(NA)
#    }, error = function(cond) {
#        return(NA)
#    }
#)
#    return(result)
}
# test <- filter(scrambled_bcs, name == 'TSS_10266_regulondb,2723831,-_scrambled5-15_flipped_rc')
scramble_ttests <- scrambled_bcs %>%
group_by(name, tss_name) %>%
do(ttest = ttest_custom(., df_wt = unscrambled_bcs)) %>%
broom::tidy(ttest) %>%
ungroup()
ttest_custom <- function(df, df_wt) {
wt_name <- df$tss_name[1]
# bind unscrambled barcodes to df
df_with_wt <- bind_rows(df,
filter(df_wt, tss_name == wt_name)) %>%
mutate(category_fctr = factor(category)) %>%
filter(!is.na(expn), is.finite(expn))
result <- tryCatch(
{
t.test(expn ~ category_fctr, df_with_wt)
}, warning = function(cond) {
return(NA)
}, error = function(cond) {
return(NA)
}
)
#    return(result)
}
# test <- filter(scrambled_bcs, name == 'TSS_10266_regulondb,2723831,-_scrambled5-15_flipped_rc')
scramble_ttests <- scrambled_bcs %>%
group_by(name, tss_name) %>%
do(ttest = ttest_custom(., df_wt = unscrambled_bcs)) %>%
broom::tidy(ttest) %>%
ungroup()
View(unscrambled_bcs)
knitr::opts_chunk$set(echo = TRUE)
setwd('~/Google Drive/WangLab/Projects/RecodingProject/')
knitr::opts_knit$set('~/Google Drive/WangLab/Projects/RecodingProject/')
library(tidyverse)
library(ggthemes)
library(gt)
library(cowplot)
library(stringr)
#library("readxl")
#library(Biostrings)
beadcodes <- read.table("../Dropsynth/bcoligo_cp12mer_384.csv", header = T, sep = ',') %>%
mutate(barcode = substr(.$Sequence, 1,12))
MCS <- "GCTAGCGGTGTTTAGTTAGCATCCGGTCTCACATGC"
eg_heg <- read.csv("E.coli_EG_HEG_recoding.csv", header = T, fill = NA) %>%
select(Gene, HR1=HR1..homologous.arm1., CDS_recoded, HR2=HR2..homologous.arm2.) %>%
mutate(seq = paste(HR1, toupper(CDS_recoded), MCS, HR2, sep = ''),
gene= paste(">", Gene, "_recoded", sep = ''),
seq_len = nchar(seq))
#Split library into different size categories
oligo2 <- filter(eg_heg, seq_len <= 391)
oligo3 <- filter(eg_heg, seq_len <= 601 & seq_len > 391)
oligo4 <- filter(eg_heg, seq_len > 601 & seq_len <= 811)
oligo5 <- filter(eg_heg, seq_len <= 1021 & seq_len > 811)
oligo6 <- filter(eg_heg, seq_len <= 1231 & seq_len > 1021)
#write out tables
write.table(oligo2, "db/EG_HEG_2oligo.fasta", row.names = F, quotes = F, sep = '\t')
#write out tables
write.table(oligo2, "db/EG_HEG_2oligo.fasta", row.names = F, quote = F, sep = '\t')
#Split library into different size categories
oligo2 <- filter(eg_heg, seq_len <= 391)
oligo3 <- filter(eg_heg, seq_len <= 601 & seq_len > 391)
oligo4 <- filter(eg_heg, seq_len > 601 & seq_len <= 811)
oligo5 <- filter(eg_heg, seq_len <= 1021 & seq_len > 811)
oligo6 <- filter(eg_heg, seq_len <= 1231 & seq_len > 1021)
#write out tables
write.table(oligo2, "db/EG_HEG_2oligo.fasta", row.names = F, quote = F, sep = '\t')
write.table(oligo3, "db/EG_HEG_3oligo.fasta", row.names = F, quote = F, sep = '\t')
write.table(oligo4, "db/EG_HEG_4oligo.fasta", row.names = F, quote = F, sep = '\t')
write.table(oligo5, "db/EG_HEG_5oligo.fasta", row.names = F, quote = F, sep = '\t')
write.table(oligo6, "db/EG_HEG_6oligo.fasta", row.names = F, quote = F, sep = '\t')
knitr::opts_chunk$set(echo = TRUE)
setwd('~/Google Drive/WangLab/Projects/RecodingProject/')
knitr::opts_knit$set('~/Google Drive/WangLab/Projects/RecodingProject/')
library(tidyverse)
library(ggthemes)
library(gt)
library(cowplot)
library(stringr)
#library("readxl")
#library(Biostrings)
beadcodes <- read.table("../Dropsynth/bcoligo_cp12mer_384.csv", header = T, sep = ',') %>%
mutate(barcode = substr(.$Sequence, 1,12))
MCS <- "GCTAGCGGTGTTTAGTTAGCATCCGGTCTCACATGC"
eg_heg <- read.csv("E.coli_EG_HEG_recoding.csv", header = T, fill = NA) %>%
select(Gene, HR1=HR1..homologous.arm1., CDS_recoded, HR2=HR2..homologous.arm2.) %>%
mutate(seq = paste(HR1, toupper(CDS_recoded), MCS, HR2, sep = ''),
gene= paste(">", Gene, "_recoded", sep = ''),
seq_len = nchar(seq))
#Split library into different size categories
oligo2 <- filter(eg_heg, seq_len <= 391)
oligo3 <- filter(eg_heg, seq_len <= 601 & seq_len > 391)
oligo4 <- filter(eg_heg, seq_len > 601 & seq_len <= 811)
oligo5 <- filter(eg_heg, seq_len <= 1021 & seq_len > 811)
oligo6 <- filter(eg_heg, seq_len <= 1231 & seq_len > 1021)
#write out tables
write.table(oligo2, "db/EG_HEG_2oligo.fasta", row.names = F, quote = F, sep = '\t')
write.table(oligo3, "db/EG_HEG_3oligo.fasta", row.names = F, quote = F, sep = '\t')
write.table(oligo4, "db/EG_HEG_4oligo.fasta", row.names = F, quote = F, sep = '\t')
write.table(oligo5, "db/EG_HEG_5oligo.fasta", row.names = F, quote = F, sep = '\t')
write.table(oligo6, "db/EG_HEG_6oligo.fasta", row.names = F, quote = F, sep = '\t')
knitr::opts_chunk$set(echo = TRUE)
setwd('~/Google Drive/WangLab/Projects/RecodingProject/')
knitr::opts_knit$set('~/Google Drive/WangLab/Projects/RecodingProject/')
library(tidyverse)
library(ggthemes)
library(gt)
library(cowplot)
library(stringr)
#library("readxl")
#library(Biostrings)
beadcodes <- read.table("../Dropsynth/bcoligo_cp12mer_384.csv", header = T, sep = ',') %>%
mutate(barcode = substr(.$Sequence, 1,12))
MCS <- "GCTAGCGGTGTTTAGTTAGCATCCGGTCTCACATGC"
eg_heg <- read.csv("E.coli_EG_HEG_recoding.csv", header = T, fill = NA) %>%
select(Gene, HR1=HR1..homologous.arm1., CDS_recoded, HR2=HR2..homologous.arm2.) %>%
mutate(seq = paste(HR1, toupper(CDS_recoded), MCS, HR2, sep = ''),
gene= paste(">", Gene, "_recoded", sep = ''),
seq_len = nchar(seq))
#Split library into different size categories
oligo2 <- filter(eg_heg, seq_len <= 391) %>% select(gene, seq)
oligo3 <- filter(eg_heg, seq_len <= 601 & seq_len > 391) %>% select(gene, seq)
oligo4 <- filter(eg_heg, seq_len > 601 & seq_len <= 811) %>% select(gene, seq)
oligo5 <- filter(eg_heg, seq_len <= 1021 & seq_len > 811) %>% select(gene, seq)
oligo6 <- filter(eg_heg, seq_len <= 1231 & seq_len > 1021) %>% select(gene, seq)
#write out tables
write.table(oligo2, "db/EG_HEG_2oligo.fasta",
row.names = F, quote = F, sep = '\n',col.names = F)
write.table(oligo3, "db/EG_HEG_3oligo.fasta",
row.names = F, quote = F, sep = '\n',col.names = F)
write.table(oligo4, "db/EG_HEG_4oligo.fasta",
row.names = F, quote = F, sep = '\n',col.names = F)
write.table(oligo5, "db/EG_HEG_5oligo.fasta",
row.names = F, quote = F, sep = '\n',col.names = F)
write.table(oligo6, "db/EG_HEG_6oligo.fasta",
row.names = F, quote = F, sep = '\n',col.names = F)
View(oligo6)
View(eg_heg)
View(oligo6)
View(eg_heg)
View(eg_heg)
View(eg_heg)
setwd("~/Google Drive/Kosuri_Lab/WoodsHole_MD_2018/Miniproject/BarSeq/scripts/")
#install.packages('genoPlotR')
library(genoPlotR)
library(plotfunctions)
library(cowplot)
library(ggplotify)
#library(binovisualfields)
md18 <- try(read_dna_seg_from_file("../ref/Phaeobacter_phage_MD18.gb"))
dss3p8 <- try(read_dna_seg_from_file("../ref/Roseobacter_phage_DSS3P8.gb"))
md18_vs_dss3p8 <- try(read_comparison_from_blast("../ref/md18_vs_dss3p8.blast.txt"))
ann_md18<-annotation(x1=middle(md18), text=md18$name, rot = 30)
ann_dss3p8<-annotation(x1=middle(dss3p8), text=dss3p8$name, rot = 30)
#comparisons[[1]]$values <- c(70, 80, 90)
#comparisons[[1]]$col <- apply_color_scheme(comparisons[[1]]$values,
#                                           direction=comparisons[[1]]$direction,
#                                           color_scheme="red_blue")
#xlims <- list(c(1,50000), c(1,50000))
plot_gene_map(dna_segs=list(md18, dss3p8),
comparisons=list(md18_vs_dss3p8),
#               annotations=list(ann_md18, ann_dss3p8), annotation_height=0.8,
#               xlims=xlims, #USE to specify specific regions
main="MD18 vs DSS3P8",
gene_type="side_blocks",
dna_seg_scale=TRUE, scale=TRUE
)
#To ssave plot, need to generate plot in console then run ggsave below. Add figure legend manually since it sucks.
#ggsave("../figs/md18_vs_dss3p8_alignment.pdf", width = 6, height = 3)
###Need to run this code in the console!!!
#plot.new()
#gradientLegend(valRange=c(signif(63.5470, 2),signif(93.75, 2)), inside = TRUE, side = 2, length = 1, width = .75,
#                pos=.5, pos.num = 4, color = c('#c6d4e1', 'red'), ncol = 3, alpha = .02) #Color based on range(md18_vs_dss3p8$per_id)
#plot_grid(as.grob(a), b)
#layout(matrix(1:2,ncol=2), width = c(2,1),height = c(1,1))
#plot(1:20, 1:20, pch = 19, cex=2, col = colfunc(20))
#legend_image <- as.raster(matrix(colfunc(20), ncol=1))
#plot(c(0,2),c(0,1),type = 'n', axes = F,xlab = '', ylab = '', main = 'legend title')
#text(x=1.5, y = seq(signif(63.5470, 2),signif(93.75, 2),l=5), labels = seq(signif(63.5470, 2),signif(93.75, 2),l=5))
#rasterImage(legend_image, 0, 0, 1,1)
plot_gene_map(dna_segs=list(md18, dss3p8), legend = T,
comparisons=list(md18_vs_dss3p8),
#               annotations=list(ann_md18, ann_dss3p8), annotation_height=0.8,
#               xlims=xlims, #USE to specify specific regions
main="MD18 vs DSS3P8",
gene_type="side_blocks",
dna_seg_scale=TRUE, scale=TRUE
)
plot_gene_map(dna_segs=list(md18, dss3p8), global_color_scheme = "auto",
comparisons=list(md18_vs_dss3p8),
#               annotations=list(ann_md18, ann_dss3p8), annotation_height=0.8,
#               xlims=xlims, #USE to specify specific regions
main="MD18 vs DSS3P8",
gene_type="side_blocks",
dna_seg_scale=TRUE, scale=TRUE
)
plot_gene_map(dna_segs=list(md18, dss3p8), global_color_scheme = "blue",
comparisons=list(md18_vs_dss3p8),
#               annotations=list(ann_md18, ann_dss3p8), annotation_height=0.8,
#               xlims=xlims, #USE to specify specific regions
main="MD18 vs DSS3P8",
gene_type="side_blocks",
dna_seg_scale=TRUE, scale=TRUE
)
plot_gene_map(dna_segs=list(md18, dss3p8), global_color_scheme = "blue_white",
comparisons=list(md18_vs_dss3p8),
#               annotations=list(ann_md18, ann_dss3p8), annotation_height=0.8,
#               xlims=xlims, #USE to specify specific regions
main="MD18 vs DSS3P8",
gene_type="side_blocks",
dna_seg_scale=TRUE, scale=TRUE
)
plot_gene_map(dna_segs=list(md18, dss3p8), global_color_scheme = c("auto", "auto", "blue", .5),
comparisons=list(md18_vs_dss3p8),
#               annotations=list(ann_md18, ann_dss3p8), annotation_height=0.8,
#               xlims=xlims, #USE to specify specific regions
main="MD18 vs DSS3P8",
gene_type="side_blocks",
dna_seg_scale=TRUE, scale=TRUE
)
plot_gene_map(dna_segs=list(md18, dss3p8), global_color_scheme = c("auto", "auto", "grey", .5),
comparisons=list(md18_vs_dss3p8),
#               annotations=list(ann_md18, ann_dss3p8), annotation_height=0.8,
#               xlims=xlims, #USE to specify specific regions
main="MD18 vs DSS3P8",
gene_type="side_blocks",
dna_seg_scale=TRUE, scale=TRUE
)
R.version()
R.Version()
temp <- norm_zotu %>%
group_by(day, tx_group, family, OTU) %>% filter(family != "Planococcaceae") %>%
summarise(mean_log10absadb = log10(mean(abs_abd))) %>% ungroup() %>% filter(tx_group == 'Jax Cohoused') %>% select(OTU, day, mean_log10absadb) %>% distinct() %>% filter(mean_log10absadb > -100 & mean_log10absadb < 100) %>% dcast(day ~ OTU)
```{r setup, include=FALSE}
setwd("~/Dropbox/fmt/experiments/2021-07-19_Lumen_Metagenomics/gene_counts/")
library(tidyverse)
Sys.setenv('R_MAX_VSIZE'=32000000000)
# read in barcode count files
filelist = list.files(path = 'pre_counts',
pattern = '*',
full.names = T)
sample_names <- filelist %>% as.data.frame %>%
mutate(sample_names = gsub('pre_counts/', '',.)) %>%
separate(., sample_names, into = c('sample_names', 'fat'), sep = '_S') %>% select(sample_names)
#Read in dataframes
for(i in seq(1:length(filelist))) {
sample_name <- sample_names$sample_names[i]
x <- read.csv(filelist[i], col.names=c('gene', sample_name), header = F)
#x <- subset(x, x[,1] > 1)   #Filter out barcodes with only one read in sample, already done in barcode_counts
names(x) <- c(sample_name, "gene")
assign(sample_name, x)
names(sample_name)
}
#List all dataframes
count_list <- lapply(ls(pattern="A"), function(x) get(x))
temp <- count_list$1
temp <- count_list[1]
temp <- count_list[1] %>% as.data.frame()
for (i in (1:5)) {
print(i)
}
for (i in (1:5)) {
print(paste('DF #' , i))
merge_df <- count_list[i] %>% as.data.frame()
full_join(temp, merge_df)
}
