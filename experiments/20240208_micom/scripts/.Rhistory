df_with_wt <- bind_rows(df,
filter(df_wt, tss_name == wt_name)) %>%
mutate(category_fctr = factor(category)) %>%
filter(!is.na(expn), is.finite(expn))
result <- tryCatch(
{
t.test(expn ~ category_fctr, df_with_wt)
}, warning = function(cond) {
return(NA)
}, error = function(cond) {
return(NA)
}
)
return(result)
}
# test <- filter(scrambled_bcs, name == 'TSS_10266_regulondb,2723831,-_scrambled5-15_flipped_rc')
scramble_ttests <- scrambled_bcs %>%
group_by(name, tss_name) %>%
do(ttest = ttest_custom(., df_wt = unscrambled_bcs)) %>%
broom::tidy(ttest) %>%
ungroup()
View(scrambled_bcs)
ttest_custom <- function(df, df_wt) {
wt_name <- df$tss_name[1]
# bind unscrambled barcodes to df
df_with_wt <- bind_rows(df,
filter(df_wt, tss_name == wt_name)) %>%
mutate(category_fctr = factor(category)) %>%
filter(!is.na(expn), is.finite(expn))
#result <- tryCatch(
{
#        t.test(expn ~ category_fctr, df_with_wt)
#    }, warning = function(cond) {
#        return(NA)
#    }, error = function(cond) {
#        return(NA)
#    }
#)
return(result)
}
# test <- filter(scrambled_bcs, name == 'TSS_10266_regulondb,2723831,-_scrambled5-15_flipped_rc')
scramble_ttests <- scrambled_bcs %>%
group_by(name, tss_name) %>%
do(ttest = ttest_custom(., df_wt = unscrambled_bcs)) %>%
broom::tidy(ttest) %>%
ungroup()
ttest_custom <- function(df, df_wt) {
wt_name <- df$tss_name[1]
# bind unscrambled barcodes to df
df_with_wt <- bind_rows(df,
filter(df_wt, tss_name == wt_name)) %>%
mutate(category_fctr = factor(category)) %>%
filter(!is.na(expn), is.finite(expn))
#result <- tryCatch(
{
#        t.test(expn ~ category_fctr, df_with_wt)
#    }, warning = function(cond) {
#        return(NA)
#    }, error = function(cond) {
#        return(NA)
#    }
#)
#    return(result)
}
# test <- filter(scrambled_bcs, name == 'TSS_10266_regulondb,2723831,-_scrambled5-15_flipped_rc')
scramble_ttests <- scrambled_bcs %>%
group_by(name, tss_name) %>%
do(ttest = ttest_custom(., df_wt = unscrambled_bcs)) %>%
broom::tidy(ttest) %>%
ungroup()
ttest_custom <- function(df, df_wt) {
wt_name <- df$tss_name[1]
# bind unscrambled barcodes to df
df_with_wt <- bind_rows(df,
filter(df_wt, tss_name == wt_name)) %>%
mutate(category_fctr = factor(category)) %>%
filter(!is.na(expn), is.finite(expn))
result <- tryCatch(
{
t.test(expn ~ category_fctr, df_with_wt)
}, warning = function(cond) {
return(NA)
}, error = function(cond) {
return(NA)
}
)
#    return(result)
}
# test <- filter(scrambled_bcs, name == 'TSS_10266_regulondb,2723831,-_scrambled5-15_flipped_rc')
scramble_ttests <- scrambled_bcs %>%
group_by(name, tss_name) %>%
do(ttest = ttest_custom(., df_wt = unscrambled_bcs)) %>%
broom::tidy(ttest) %>%
ungroup()
View(unscrambled_bcs)
knitr::opts_chunk$set(echo = TRUE)
setwd('~/Google Drive/WangLab/Projects/RecodingProject/')
knitr::opts_knit$set('~/Google Drive/WangLab/Projects/RecodingProject/')
library(tidyverse)
library(ggthemes)
library(gt)
library(cowplot)
library(stringr)
#library("readxl")
#library(Biostrings)
beadcodes <- read.table("../Dropsynth/bcoligo_cp12mer_384.csv", header = T, sep = ',') %>%
mutate(barcode = substr(.$Sequence, 1,12))
MCS <- "GCTAGCGGTGTTTAGTTAGCATCCGGTCTCACATGC"
eg_heg <- read.csv("E.coli_EG_HEG_recoding.csv", header = T, fill = NA) %>%
select(Gene, HR1=HR1..homologous.arm1., CDS_recoded, HR2=HR2..homologous.arm2.) %>%
mutate(seq = paste(HR1, toupper(CDS_recoded), MCS, HR2, sep = ''),
gene= paste(">", Gene, "_recoded", sep = ''),
seq_len = nchar(seq))
#Split library into different size categories
oligo2 <- filter(eg_heg, seq_len <= 391)
oligo3 <- filter(eg_heg, seq_len <= 601 & seq_len > 391)
oligo4 <- filter(eg_heg, seq_len > 601 & seq_len <= 811)
oligo5 <- filter(eg_heg, seq_len <= 1021 & seq_len > 811)
oligo6 <- filter(eg_heg, seq_len <= 1231 & seq_len > 1021)
#write out tables
write.table(oligo2, "db/EG_HEG_2oligo.fasta", row.names = F, quotes = F, sep = '\t')
#write out tables
write.table(oligo2, "db/EG_HEG_2oligo.fasta", row.names = F, quote = F, sep = '\t')
#Split library into different size categories
oligo2 <- filter(eg_heg, seq_len <= 391)
oligo3 <- filter(eg_heg, seq_len <= 601 & seq_len > 391)
oligo4 <- filter(eg_heg, seq_len > 601 & seq_len <= 811)
oligo5 <- filter(eg_heg, seq_len <= 1021 & seq_len > 811)
oligo6 <- filter(eg_heg, seq_len <= 1231 & seq_len > 1021)
#write out tables
write.table(oligo2, "db/EG_HEG_2oligo.fasta", row.names = F, quote = F, sep = '\t')
write.table(oligo3, "db/EG_HEG_3oligo.fasta", row.names = F, quote = F, sep = '\t')
write.table(oligo4, "db/EG_HEG_4oligo.fasta", row.names = F, quote = F, sep = '\t')
write.table(oligo5, "db/EG_HEG_5oligo.fasta", row.names = F, quote = F, sep = '\t')
write.table(oligo6, "db/EG_HEG_6oligo.fasta", row.names = F, quote = F, sep = '\t')
knitr::opts_chunk$set(echo = TRUE)
setwd('~/Google Drive/WangLab/Projects/RecodingProject/')
knitr::opts_knit$set('~/Google Drive/WangLab/Projects/RecodingProject/')
library(tidyverse)
library(ggthemes)
library(gt)
library(cowplot)
library(stringr)
#library("readxl")
#library(Biostrings)
beadcodes <- read.table("../Dropsynth/bcoligo_cp12mer_384.csv", header = T, sep = ',') %>%
mutate(barcode = substr(.$Sequence, 1,12))
MCS <- "GCTAGCGGTGTTTAGTTAGCATCCGGTCTCACATGC"
eg_heg <- read.csv("E.coli_EG_HEG_recoding.csv", header = T, fill = NA) %>%
select(Gene, HR1=HR1..homologous.arm1., CDS_recoded, HR2=HR2..homologous.arm2.) %>%
mutate(seq = paste(HR1, toupper(CDS_recoded), MCS, HR2, sep = ''),
gene= paste(">", Gene, "_recoded", sep = ''),
seq_len = nchar(seq))
#Split library into different size categories
oligo2 <- filter(eg_heg, seq_len <= 391)
oligo3 <- filter(eg_heg, seq_len <= 601 & seq_len > 391)
oligo4 <- filter(eg_heg, seq_len > 601 & seq_len <= 811)
oligo5 <- filter(eg_heg, seq_len <= 1021 & seq_len > 811)
oligo6 <- filter(eg_heg, seq_len <= 1231 & seq_len > 1021)
#write out tables
write.table(oligo2, "db/EG_HEG_2oligo.fasta", row.names = F, quote = F, sep = '\t')
write.table(oligo3, "db/EG_HEG_3oligo.fasta", row.names = F, quote = F, sep = '\t')
write.table(oligo4, "db/EG_HEG_4oligo.fasta", row.names = F, quote = F, sep = '\t')
write.table(oligo5, "db/EG_HEG_5oligo.fasta", row.names = F, quote = F, sep = '\t')
write.table(oligo6, "db/EG_HEG_6oligo.fasta", row.names = F, quote = F, sep = '\t')
knitr::opts_chunk$set(echo = TRUE)
setwd('~/Google Drive/WangLab/Projects/RecodingProject/')
knitr::opts_knit$set('~/Google Drive/WangLab/Projects/RecodingProject/')
library(tidyverse)
library(ggthemes)
library(gt)
library(cowplot)
library(stringr)
#library("readxl")
#library(Biostrings)
beadcodes <- read.table("../Dropsynth/bcoligo_cp12mer_384.csv", header = T, sep = ',') %>%
mutate(barcode = substr(.$Sequence, 1,12))
MCS <- "GCTAGCGGTGTTTAGTTAGCATCCGGTCTCACATGC"
eg_heg <- read.csv("E.coli_EG_HEG_recoding.csv", header = T, fill = NA) %>%
select(Gene, HR1=HR1..homologous.arm1., CDS_recoded, HR2=HR2..homologous.arm2.) %>%
mutate(seq = paste(HR1, toupper(CDS_recoded), MCS, HR2, sep = ''),
gene= paste(">", Gene, "_recoded", sep = ''),
seq_len = nchar(seq))
#Split library into different size categories
oligo2 <- filter(eg_heg, seq_len <= 391) %>% select(gene, seq)
oligo3 <- filter(eg_heg, seq_len <= 601 & seq_len > 391) %>% select(gene, seq)
oligo4 <- filter(eg_heg, seq_len > 601 & seq_len <= 811) %>% select(gene, seq)
oligo5 <- filter(eg_heg, seq_len <= 1021 & seq_len > 811) %>% select(gene, seq)
oligo6 <- filter(eg_heg, seq_len <= 1231 & seq_len > 1021) %>% select(gene, seq)
#write out tables
write.table(oligo2, "db/EG_HEG_2oligo.fasta",
row.names = F, quote = F, sep = '\n',col.names = F)
write.table(oligo3, "db/EG_HEG_3oligo.fasta",
row.names = F, quote = F, sep = '\n',col.names = F)
write.table(oligo4, "db/EG_HEG_4oligo.fasta",
row.names = F, quote = F, sep = '\n',col.names = F)
write.table(oligo5, "db/EG_HEG_5oligo.fasta",
row.names = F, quote = F, sep = '\n',col.names = F)
write.table(oligo6, "db/EG_HEG_6oligo.fasta",
row.names = F, quote = F, sep = '\n',col.names = F)
View(oligo6)
View(eg_heg)
View(oligo6)
View(eg_heg)
View(eg_heg)
View(eg_heg)
setwd("~/Google Drive/Kosuri_Lab/WoodsHole_MD_2018/Miniproject/BarSeq/scripts/")
#install.packages('genoPlotR')
library(genoPlotR)
library(plotfunctions)
library(cowplot)
library(ggplotify)
#library(binovisualfields)
md18 <- try(read_dna_seg_from_file("../ref/Phaeobacter_phage_MD18.gb"))
dss3p8 <- try(read_dna_seg_from_file("../ref/Roseobacter_phage_DSS3P8.gb"))
md18_vs_dss3p8 <- try(read_comparison_from_blast("../ref/md18_vs_dss3p8.blast.txt"))
ann_md18<-annotation(x1=middle(md18), text=md18$name, rot = 30)
ann_dss3p8<-annotation(x1=middle(dss3p8), text=dss3p8$name, rot = 30)
#comparisons[[1]]$values <- c(70, 80, 90)
#comparisons[[1]]$col <- apply_color_scheme(comparisons[[1]]$values,
#                                           direction=comparisons[[1]]$direction,
#                                           color_scheme="red_blue")
#xlims <- list(c(1,50000), c(1,50000))
plot_gene_map(dna_segs=list(md18, dss3p8),
comparisons=list(md18_vs_dss3p8),
#               annotations=list(ann_md18, ann_dss3p8), annotation_height=0.8,
#               xlims=xlims, #USE to specify specific regions
main="MD18 vs DSS3P8",
gene_type="side_blocks",
dna_seg_scale=TRUE, scale=TRUE
)
#To ssave plot, need to generate plot in console then run ggsave below. Add figure legend manually since it sucks.
#ggsave("../figs/md18_vs_dss3p8_alignment.pdf", width = 6, height = 3)
###Need to run this code in the console!!!
#plot.new()
#gradientLegend(valRange=c(signif(63.5470, 2),signif(93.75, 2)), inside = TRUE, side = 2, length = 1, width = .75,
#                pos=.5, pos.num = 4, color = c('#c6d4e1', 'red'), ncol = 3, alpha = .02) #Color based on range(md18_vs_dss3p8$per_id)
#plot_grid(as.grob(a), b)
#layout(matrix(1:2,ncol=2), width = c(2,1),height = c(1,1))
#plot(1:20, 1:20, pch = 19, cex=2, col = colfunc(20))
#legend_image <- as.raster(matrix(colfunc(20), ncol=1))
#plot(c(0,2),c(0,1),type = 'n', axes = F,xlab = '', ylab = '', main = 'legend title')
#text(x=1.5, y = seq(signif(63.5470, 2),signif(93.75, 2),l=5), labels = seq(signif(63.5470, 2),signif(93.75, 2),l=5))
#rasterImage(legend_image, 0, 0, 1,1)
plot_gene_map(dna_segs=list(md18, dss3p8), legend = T,
comparisons=list(md18_vs_dss3p8),
#               annotations=list(ann_md18, ann_dss3p8), annotation_height=0.8,
#               xlims=xlims, #USE to specify specific regions
main="MD18 vs DSS3P8",
gene_type="side_blocks",
dna_seg_scale=TRUE, scale=TRUE
)
plot_gene_map(dna_segs=list(md18, dss3p8), global_color_scheme = "auto",
comparisons=list(md18_vs_dss3p8),
#               annotations=list(ann_md18, ann_dss3p8), annotation_height=0.8,
#               xlims=xlims, #USE to specify specific regions
main="MD18 vs DSS3P8",
gene_type="side_blocks",
dna_seg_scale=TRUE, scale=TRUE
)
plot_gene_map(dna_segs=list(md18, dss3p8), global_color_scheme = "blue",
comparisons=list(md18_vs_dss3p8),
#               annotations=list(ann_md18, ann_dss3p8), annotation_height=0.8,
#               xlims=xlims, #USE to specify specific regions
main="MD18 vs DSS3P8",
gene_type="side_blocks",
dna_seg_scale=TRUE, scale=TRUE
)
plot_gene_map(dna_segs=list(md18, dss3p8), global_color_scheme = "blue_white",
comparisons=list(md18_vs_dss3p8),
#               annotations=list(ann_md18, ann_dss3p8), annotation_height=0.8,
#               xlims=xlims, #USE to specify specific regions
main="MD18 vs DSS3P8",
gene_type="side_blocks",
dna_seg_scale=TRUE, scale=TRUE
)
plot_gene_map(dna_segs=list(md18, dss3p8), global_color_scheme = c("auto", "auto", "blue", .5),
comparisons=list(md18_vs_dss3p8),
#               annotations=list(ann_md18, ann_dss3p8), annotation_height=0.8,
#               xlims=xlims, #USE to specify specific regions
main="MD18 vs DSS3P8",
gene_type="side_blocks",
dna_seg_scale=TRUE, scale=TRUE
)
plot_gene_map(dna_segs=list(md18, dss3p8), global_color_scheme = c("auto", "auto", "grey", .5),
comparisons=list(md18_vs_dss3p8),
#               annotations=list(ann_md18, ann_dss3p8), annotation_height=0.8,
#               xlims=xlims, #USE to specify specific regions
main="MD18 vs DSS3P8",
gene_type="side_blocks",
dna_seg_scale=TRUE, scale=TRUE
)
R.version()
R.Version()
temp <- norm_zotu %>%
group_by(day, tx_group, family, OTU) %>% filter(family != "Planococcaceae") %>%
summarise(mean_log10absadb = log10(mean(abs_abd))) %>% ungroup() %>% filter(tx_group == 'Jax Cohoused') %>% select(OTU, day, mean_log10absadb) %>% distinct() %>% filter(mean_log10absadb > -100 & mean_log10absadb < 100) %>% dcast(day ~ OTU)
---
title: "MAGstats"
# Chunk 1: setup
setwd("/Users/guillaumeurtecho/Dropbox/fmt/experiments/20240208_micom/scripts/")
library(tidyverse)
library(wesanderson)
library(ggthemes)
library(cowplot)
library(ggsignif)
library(reshape2)
library(RColorBrewer)
#library('phyloseq')
ven <- c('#FAAF40',"#1B75BB", "#37B34A","#F05A28")
pal <- wes_palette("Zissou1", 100, type = "continuous")
options(stringsAsFactors = F)
options(scipen = 10000)
lengths <- read.csv('../ref/output_10_reAssemblyDuplicates.stat', sep = '\t') %>% select(id=assemblyID, totalLength)
data <- read.csv('../processed_data/MAG_stats.csv') %>% select(-X) %>%
separate(id, into = c('cohort', 'mag_no'), sep = '_', remove = F) %>%
group_by(sample_id) %>%
mutate(rel_abundace = (abundance/sum(abundance))*50000) %>% ungroup() %>% left_join(., lengths)
taxa_cols <- c("#E11F26","#FBB019")
vendor_cols <- c(c("#37B34A", "#F05A28","#1B75BB",'#FAAF40'))
bugColors <- read.table('../../../tables/bugColors2.txt', sep = '\t')
bugColors <- setNames(bugColors$x, rownames(bugColors))
# Chunk 2
#Look at genome sizes
data %>% select(order, family, id, cohort, totalLength) %>%
distinct() %>%
filter(order == 'Bacteroidales') %>%
ggplot(., aes(cohort, totalLength,)) +
stat_boxplot(geom = 'errorbar', width = .35) +
geom_boxplot(outlier.shape = NA) +
geom_jitter(aes(color=family)) + theme_clean() + facet_wrap(~family)
data %>% select(order, family, id, cohort, totalLength) %>%
# filter(cohort == 'AZC3J' | cohort == 'AZC7E') %>%
mutate(totalLength = totalLength/1000000) %>%
distinct() %>%
filter(family == 'Muribaculaceae'| family == 'Bacteroidaceae') %>%
#  filter(order == 'Bacteroidales') %>%
ggplot(., aes(cohort, totalLength,)) +
stat_boxplot(geom = 'errorbar', width = .15) +
geom_boxplot(outlier.shape = NA, width = .35) +
geom_jitter(aes(color=cohort)) +
theme_clean() + #facet_wrap(~family)
scale_color_manual(values = vendor_cols) +
geom_signif(comparisons = list(c("AZC3J", "AZC7E")),
map_signif_level = F,
test = "wilcox.test",
test.args='greater') + labs(x = '', y = 'MAG Size (Mbp)') +
theme(axis.text = element_text(size = 14),
axis.title = element_text(size = 14), legend.title = element_blank())
ggsave("../figs/MAGsizes.pdf", width = 4, height = 3)
#how many observations?
data %>%   filter(family == 'Muribaculaceae'| family == 'Bacteroidaceae') %>%
select(id, cohort) %>% distinct() %>% group_by(cohort) %>% mutate(num_taxa = n()) %>% select(cohort, num_taxa) %>% distinct()
# Chunk 3
independence_completeness <- read.csv("../processed_data/enrichment_score_vs_module.csv")
#Look at completeness of modules
independence_completeness %>%
select(group, module, module_category, percentage) %>%
distinct() %>%
ggplot(aes(x = group, y = percentage)) +
stat_boxplot(geom = 'errorbar', width = .15) +
geom_boxplot(outlier.shape = NA, width = .35) +
geom_jitter(aes(color = module_category), position = position_jitter(width = 0.2)) +
scale_color_brewer(palette = "Set1") +
theme_cowplot() +
geom_signif(comparisons = list(c("AZC3J", "AZC7E")),
map_signif_level = T,
test = "wilcox.test") +
labs(x = '', y = 'Community-level Module Completeness') +
theme(axis.text = element_text(size = 14),
axis.title = element_text(size = 14),
legend.title = element_blank())
ggsave("../figs/ModuleCompleteness.pdf", width = 7, height = 3.5)
temp <- independence_completeness %>%
select(group, module, module_category, percentage) %>%
distinct()
wilcox.test(temp %>% filter(group == 'AZC3J') %>% pull(percentage),
temp %>% filter(group == 'AZC7E') %>% pull(percentage))
# Chunk 4
presence <- read.csv('../processed_data/MAG_metabolism-module_stepwise_presence-MATRIX.txt', header = T, sep = '\t') %>% melt() %>% filter(value == 1) %>% group_by(variable) %>% mutate(num_modules = n()) %>% ungroup %>% select(variable, num_modules) %>% distinct() %>%
separate(variable, into = c('mouse_group', 'MAG'), remove = F)
presence %>% ggplot(., aes(mouse_group, num_modules,)) +
stat_boxplot(geom = 'errorbar', width = .15) +
geom_boxplot(outlier.shape = NA, width = .35) +
geom_jitter(aes(color=mouse_group)) + theme_clean() + #facet_wrap(~family)
scale_color_manual(values = taxa_cols) +
geom_signif(comparisons = list(c("AZC3J", "AZC7E")),
map_signif_level = F,
test = "wilcox.test",
test.args='greater') + labs(x = '', y = 'Modules Present') +
theme(axis.text = element_text(size = 14),
axis.title = element_text(size = 14), legend.title = element_blank())
# Chunk 5
independence <- read.csv('../processed_data/genome_score_family.csv', header = T, sep = ',')
independence %>% ggplot(., aes(group, score)) +
stat_boxplot(geom = 'errorbar', width = .15) +
geom_boxplot(outlier.shape = NA, width = .35) +
geom_jitter(aes(color=group)) + theme_clean() + #facet_wrap(~family)
scale_color_manual(values = vendor_cols) +
geom_signif(comparisons = list(c("AZC3J", "AZC7E")),
map_signif_level = F,
test = "wilcox.test",
test.args='greater') + labs(x = '', y = 'Metabolic Independence') +
theme(axis.text = element_text(size = 14),
axis.title = element_text(size = 14), legend.title = element_blank())
ggsave("../figs/MetabolicIndependence.pdf", width = 4.1, height = 3)
# Chunk 6
enrichment <- read.csv("../processed_data/metagenomic.enrichment.csv") %>% #rename('assembly'='taxon') %>%
group_by(assembly) %>% mutate(mean_fc = mean(log2fold_change),
mean_d0 = mean(d0_abundance),
mean_d5 = mean(d5_abundance)
) %>% ungroup %>% select(assembly, mean_d0, mean_d5, mean_fc, shift) %>% distinct()
tSNE<- read.csv("../processed_data/reduced.csv") %>% rename('assembly'='taxon') %>% inner_join(., enrichment) %>%
mutate(supplier = ifelse(grepl('AZC7E', assembly), 'Envigo', 'Jackson')) %>%
group_by(assembly) %>% mutate(TSNE.1_ave = mean(TSNE.1),
TSNE.2_ave = mean(TSNE.2)) %>% ungroup %>%
select(assembly, TSNE.1_ave, TSNE.2_ave, supplier, shift, mean_d0, mean_d5, mean_fc) %>% distinct()
# First plot all points in one color
tSNE %>%
ggplot(aes(x = TSNE.1_ave, y = TSNE.2_ave, color = supplier)) +
geom_point(alpha = 0.5) + # Set alpha for better visibility if points overlap
theme_cowplot() +
labs(color = "Supplier") # Label for the legend
# Then add points for 'Envigo' with a gradient color scale
tSNE %>%
filter(supplier == 'Envigo') %>%
ggplot(aes(x = TSNE.1_ave, y = TSNE.2_ave, color = mean_fc)) +
geom_point(size = 2) +
scale_color_gradient(low = "blue", high = "red") +
theme_cowplot() +
labs(color = "Mean FC") # Label for the legend
write.csv(enrichment, "../processed_data/MAGenrichmentEnv2Jax.csv", quote = F, row.names = F)
# Chunk 7
#get growth rates for all according to MICOM
growth_rates <- read.csv("../processed_data/growth_rates_comparison_entire_MAGs.csv") %>% select(-X, -abundance_high_fiber, -abundance_western) %>%
rename('High Fiber' = 'growth_rate_high_fiber', 'Western' = 'growth_rate_western') %>%
melt(id.vars = 'MAGs') %>%
mutate(supplier = ifelse(grepl('AZC7E', MAGs), 'Envigo', 'Jackson')) %>% group_by(variable, MAGs, supplier) %>%
mutate(value = mean(value), value = mean(value)) %>% ungroup() %>% distinct() %>%
left_join(., data %>% select('MAGs'='id', order) %>% distinct())
# Perform t-tests
sig_HF <- growth_rates %>% filter(variable == 'High Fiber') %>%
summarise(p_value = t.test(value ~ supplier, data = .)$p.value)
sig_west <- growth_rates %>% filter(variable == 'Western') %>%
summarise(p_value = t.test(value ~ supplier, data = .)$p.value)
# Plot with jitter/dodge and legend in top-left corner
plot <- ggplot(growth_rates, aes(variable, value, fill = supplier)) +
geom_boxplot(position = position_dodge(width = 0.75), width = 0.6, outlier.shape = NA) +
geom_jitter(position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.75), size = 1.5) +
theme_cowplot() +
labs(x = 'Diet', y = 'OTU Simulated Growth Rate') +
theme(legend.position = c(0.98, 0.98), legend.justification = c("right", "top"),
axis.text = element_text(size = 14)) +
scale_fill_manual(values = c(vendor_cols[3], vendor_cols[1])) +
annotate(geom = 'text', x = 'High Fiber', y = 1.15, label = signif(sig_HF, 2)) +
annotate(geom = 'text', x = 'Western', y = .4, label = signif(sig_west, 2)) +
geom_segment(aes(x = 0.8, xend = 1.2, y = 1.12, yend = 1.12), color = "black") + # Segment under "High Fiber"
geom_segment(aes(x = 1.8, xend = 2.2, y = 0.37, yend = 0.37), color = "black")  # Segment under "Western"
plot
#ggsave("../figs/GrowthRate.pdf", width = 4.1, height = 3)
# Chunk 8
temp <- read.csv("../processed_data/postFMT_res_high_fiber_grow_rate_entire_MAGs.csv") %>%
select('MAGs'='compartments', 'High Fiber' = growth_rate) %>%  melt(id.vars = 'MAGs') %>%
mutate(supplier = 'PostFMT') %>% group_by(variable, MAGs, supplier) %>%
mutate(value = mean(value), value = mean(value)) %>% ungroup() %>% distinct() %>%
left_join(., data %>% select('MAGs'='id', order) %>% distinct()) %>% rbind(
read.csv("../processed_data/postFMT_res_western_grow_rates_entire_MAGs.csv") %>%
select('MAGs'='compartments', 'Western' = growth_rate) %>%  melt(id.vars = 'MAGs') %>%
mutate(supplier = 'PostFMT') %>% group_by(variable, MAGs, supplier) %>%
mutate(value = mean(value), value = mean(value)) %>% ungroup() %>% distinct() %>%
left_join(., data %>% select('MAGs'='id', order) %>% distinct())
)
all_growthrates <- rbind(temp, growth_rates)
# Perform t-tests
sig_HF <- all_growthrates %>% filter(variable == 'High Fiber' & supplier != 'Envigo') %>%
summarise(p_value = t.test(value ~ supplier, data = .)$p.value)
#.00340
sig_west <- all_growthrates %>% filter(variable == 'Western' & supplier != 'Envigo') %>%
summarise(p_value = t.test(value ~ supplier, data = .)$p.value)
#.00234
plot <- all_growthrates %>% ggplot(., aes(variable, value, fill = supplier)) +
geom_boxplot(position = position_dodge(width = 0.75), width = 0.6, outlier.shape = NA) +
geom_jitter(position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.75), size = 1.5, alpha = .4) +
theme_cowplot() +
labs(x = 'Diet', y = 'OTU Simulated Growth Rate') +
theme(legend.position = c(0.98, 0.98), legend.justification = c("right", "top"),
axis.text = element_text(size = 14)) +
scale_fill_manual(values = c(vendor_cols[3], vendor_cols[1], '#26a9e0')) +
annotate(geom = 'text', x = 1.1, y = 1.15, label = signif(sig_HF, 2)) +
annotate(geom = 'text', x = 2.1, y = .4, label = signif(sig_west, 2)) +
geom_segment(aes(x = 1, xend = 1.2, y = 1.12, yend = 1.12), color = "black") + # Segment under "High Fiber"
geom_segment(aes(x = 2, xend = 2.2, y = 0.37, yend = 0.37), color = "black")  # Segment under "Western"
plot
ggsave("../figs/GrowthRate.pdf", width = 4.1, height = 3)
# Chunk 9
ggplot(growth_rates, aes(order, value, fill = supplier)) +
geom_boxplot(position = position_dodge(width = 0.75), width = 0.6) +
geom_jitter(aes(color = order),position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.75), size = 1.5) +
theme_cowplot() +
labs(x = 'Diet', y = 'OTU Simulated Growth Rate') +
theme(legend.position = c(0.98, 0.98), legend.justification = c("right", "top"),
axis.text = element_text(size = 14)) +
scale_fill_manual(values = c(vendor_cols[3], vendor_cols[1])) +
facet_wrap(~variable) + theme(axis.text.x = element_text(angle = 45, hjust = 1))
View(data)
data %>% select("MAG"='id', cohort, domain, phylum, class, order, family, genus, species, totalLength) %>% distinct()
#how many observations?
data %>%   filter(family == 'Muribaculaceae'| family == 'Bacteroidaceae') %>%
select(id, cohort) %>% distinct() %>% group_by(cohort) %>% mutate(num_taxa = n()) %>% select(cohort, num_taxa) %>% distinct()
MAG_df <- data %>% select("MAG"='id', cohort, domain, phylum, class, order, family, genus, species, totalLength) %>% distinct()
View(MAG_df)
data %>% select("MAG"='id', cohort, domain, phylum, class, order, family, genus, species, totalLength) %>% distinct() %>% write.csv(., "../../../tables/MAG_descriptions.csv", quote = F, row.names = F)
