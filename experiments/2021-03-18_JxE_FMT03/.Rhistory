# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(x = log10_rel_abd, y = (..count..)/sum(..count..)), binwidth = 0.25) +
facet_grid(genus~.) +
theme(strip.text.y = element_text(angle=0))
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(x = log10_rel_abd, y = (..count..)/sum(..count..)), binwidth = 0.25) +
facet_grid(genus~., scales = "free") +
theme(strip.text.y = element_text(angle=0))
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(x = log10_rel_abd, y = (..count..)/sum(..count..)), binwidth = 0.25) +
facet_grid(genus~.) +
theme(strip.text.y = element_text(angle=0))
# Look at rumino abd
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
group_by(genus, species) %>%
summarize(mean_rel_abd = mean(rel_abd), .groups = "drop")
# Look at distribution of individual Ruminococcaceae species log10 relative abundance
tidy.otu %>%
filter(species == "s__Agathobaculum_butyriciproducens") %>%
ggplot() +
geom_histogram(aes(x = log10_rel_abd, y = (..count..)/sum(..count..)), binwidth = 0.25) +
facet_grid(genus~.) +
theme(strip.text.y = element_text(angle=0))
library(tidyverse)
# Set wd to parent experiment folder
setwd("~/Dropbox/projects/fmt/experiments/2021-03-18_JxE_FMT03/")
# Load Data
zotu <- read_csv("data/tidy_zotu.csv")
# Set wd to parent experiment folder
setwd("~/Dropbox/projects/fmt/experiments/2021-03-18_JxE_FMT03/")
library(tidyverse)
rm(list=ls())
# Set wd to parent experiment folder
setwd("~/Dropbox/projects/fmt/experiments/2021-03-18_JxE_FMT03/")
# Load Data
zotu <- read_csv("data/tidy_zotu.csv")
# Convert day to a factor, w/ levels to force order
day.levels <- zotu %>%
select(day) %>%
arrange(day) %>%
unique() %>%
as_vector()
zotu$day <- factor(zotu$day, levels = day.levels)
# Force phylo order
genus.levels <- zotu %>%
arrange(domain, phylum, class, order, family, genus) %>%
select(genus) %>%
unique() %>%
as_vector()
zotu$genus <- factor(zotu$genus, levels = genus.levels)
# Create list of OTUs filtered to certain average abundance at day 0
# done independently for both Jax & Envigo, then merged and unique'd
filter.level <- .01
filtered.OTUs <- zotu %>%
filter(day == 0) %>%
filter(tx_group %in% c("jax_control", "envigo_control")) %>%
group_by(mouse_type, OTU) %>%
summarise(mean_rel_abd = mean(rel_abd), .groups = "drop") %>%
filter(mean_rel_abd > filter.level) %>%
select(OTU) %>%
unique() %>%
as_vector()
filtered.zotu <- zotu %>%
filter(OTU %in% filtered.OTUs)
filtered.zotu %>%
select(rel_abd) %>%
filter(rel_abd > 0) %>%
min()
# Prepare palette colors
pal.colors <- c("#647CBD", "#DBDDE0", "#E0624E")
filtered.zotu %>%
filter(tx_group == "jax_envigo_mix") %>%
ggplot() +
geom_tile(aes(x=seqid, y=OTU, fill=log10(rel_abd))) +
scale_fill_gradientn(colours = pal.colors,
guide = guide_colorbar(frame.colour = "black", ticks.colour = "black")) +
facet_grid(.~day, scales = "free", space = "free")
# Relative abundance heatmap : Day vs. OTU, color by log10 rel_abd
rel.abd.heatmap <- filtered.zotu %>%
filter(!(mouse_type == "envigo" & tx_group == "jax_envigo_mix")) %>%
group_by(tx_group, day, genus, OTU) %>%
summarise(mean_rel_abd = mean(rel_abd), .groups = "keep") %>%
ungroup() %>%
mutate(log10_mean_rel_abd = if_else(mean_rel_abd == 0, -5, log10(mean_rel_abd))) %>%
ggplot() +
geom_tile(aes(x=day, y=OTU, fill=log10_mean_rel_abd), color = "black") +
facet_grid(genus~tx_group, space="free", scales="free") +
theme_bw() +
theme(strip.text.y.right = element_text(angle = 0)) +
scale_fill_gradientn(colours = pal.colors,
guide = guide_colorbar(frame.colour = "black", ticks.colour = "black"))
rel.abd.heatmap
# Relative abundance heatmap : Day vs. OTU, color by log10 rel_abd
rel.abd.heatmap <- filtered.zotu %>%
filter(!(mouse_type == "envigo" & tx_group == "jax_envigo_mix")) %>%
group_by(tx_group, day, genus, OTU) %>%
summarise(mean_rel_abd = mean(rel_abd), .groups = "keep") %>%
ungroup() %>%
mutate(log10_mean_rel_abd = if_else(mean_rel_abd == 0, -5, log10(mean_rel_abd))) %>%
ggplot() +
geom_tile(aes(x=day, y=OTU, fill=log10_mean_rel_abd), color = "black") +
facet_grid(genus~tx_group, space="free", scales="free") +
theme_bw() +
theme(strip.text.y.right = element_text(angle = 0)) +
scale_fill_gradientn(colours = pal.colors,
guide = guide_colorbar(frame.colour = "black", ticks.colour = "black"))
rel.abd.heatmap
ggsave("figures/02_rel_abd_heatmap.svg", rel.abd.heatmap)
ggsave("figures/02_rel_abd_heatmap.png", rel.abd.heatmap)
filter.zotu %>%
filter(!(mouse_type == "envigo" & tx_group == "jax_envigo_mix"))
filter.zotu %>%
filter(!(mouse_type == "envigo" & tx_group == "jax_envigo_mix"))
filtered.zotu %>%
filter(!(mouse_type == "envigo" & tx_group == "jax_envigo_mix"))
JE <- filtered.zotu %>%
filter(!(mouse_type == "envigo" & tx_group == "jax_envigo_mix"))
J0 <- filtered.zotu %>%
filter(tx_group == "jax_control")
J0 <- filtered.zotu %>%
filter(tx_group == "jax_control") %>%
filter(day == 0)
E0 <- filtered.zotu %>%
filter(tx_group == "envigo_control") %>%
filter(day == 0)
J0 %>%
bind_rows(E0)
J0 %>%
bind_rows(E0) %>%
bind_rows(JE)
avg <- J0 %>%
bind_rows(E0) %>%
bind_rows(JE) %>%
group_by(tx_group, day, genus, OTU) %>%
summarise(mean_rel_abd = mean(rel_abd), .groups = "keep") %>%
ungroup() %>%
mutate(log10_mean_rel_abd = if_else(mean_rel_abd == 0, -5, log10(mean_rel_abd)))
# Relative abundance heatmap : Day vs. OTU, color by log10 rel_abd
rel.abd.heatmap <- avg %>%
ggplot() +
geom_tile(aes(x=day, y=OTU, fill=log10_mean_rel_abd), color = "black") +
facet_grid(genus~tx_group, space="free", scales="free") +
theme_bw() +
theme(strip.text.y.right = element_text(angle = 0)) +
scale_fill_gradientn(colours = pal.colors,
guide = guide_colorbar(frame.colour = "black", ticks.colour = "black"))
rel.abd.heatmap
rel.abd.heatmap
View(J0)
JE <- filtered.zotu %>%
filter(tx_group == "jax_envigo_mix") %>%
filter(mouse_type == "jax")
avg <- J0 %>%
bind_rows(E0) %>%
bind_rows(JE) %>%
group_by(tx_group, day, genus, OTU) %>%
summarise(mean_rel_abd = mean(rel_abd), .groups = "keep") %>%
ungroup() %>%
mutate(log10_mean_rel_abd = if_else(mean_rel_abd == 0, -5, log10(mean_rel_abd)))
# Prepare palette colors
pal.colors <- c("#647CBD", "#DBDDE0", "#E0624E")
# Relative abundance heatmap : Day vs. OTU, color by log10 rel_abd
rel.abd.heatmap <- avg %>%
ggplot() +
geom_tile(aes(x=day, y=OTU, fill=log10_mean_rel_abd), color = "black") +
facet_grid(genus~tx_group, space="free", scales="free") +
theme_bw() +
theme(strip.text.y.right = element_text(angle = 0)) +
scale_fill_gradientn(colours = pal.colors,
guide = guide_colorbar(frame.colour = "black", ticks.colour = "black"))
rel.abd.heatmap
# Relative abundance heatmap : Day vs. OTU, color by log10 rel_abd
rel.abd.heatmap <- avg %>%
ggplot() +
geom_tile(aes(x=day, y=OTU, fill=log10_mean_rel_abd), color = "black") +
facet_grid(genus~tx_group, space="free", scales="free") +
theme_bw() +
theme(strip.text.y.right = element_text(angle = 0)) +
ylab("ZOTU") +
xlab("Day post-Co-housing") +
scale_fill_gradientn(colours = pal.colors,
guide = guide_colorbar(frame.colour = "black", ticks.colour = "black"))
rel.abd.heatmap
# Relative abundance heatmap : Day vs. OTU, color by log10 rel_abd
rel.abd.heatmap <- avg %>%
ggplot() +
geom_tile(aes(x=day, y=OTU, fill=log10_mean_rel_abd), color = "black") +
facet_grid(genus~tx_group, space="free", scales="free") +
theme_bw() +
theme(strip.text.y.right = element_text(angle = 0)) +
ylab("ZOTU") +
xlab("Day post-Co-housing") +
theme(strip.background=element_rect(fill="white")) +
scale_fill_gradientn(colours = pal.colors,
guide = guide_colorbar(frame.colour = "black", ticks.colour = "black"))
rel.abd.heatmap
# Relative abundance heatmap : Day vs. OTU, color by log10 rel_abd
rel.abd.heatmap <- avg %>%
ggplot() +
geom_tile(aes(x=day, y=OTU, fill=log10_mean_rel_abd), color = "black") +
facet_grid(genus~tx_group, space="free", scales="free") +
theme_bw() +
theme(strip.text.y.right = element_text(angle = 0)) +
ylab("ZOTU") +
xlab("Day post-Co-housing") +
theme(strip.background=element_rect(fill="white")) +
theme(panel.border = element_rect(color = "black", fill = NA, size = 1)) +
scale_fill_gradientn(colours = pal.colors,
guide = guide_colorbar(frame.colour = "black", ticks.colour = "black"))
rel.abd.heatmap
# Relative abundance heatmap : Day vs. OTU, color by log10 rel_abd
rel.abd.heatmap <- avg %>%
ggplot() +
geom_tile(aes(x=day, y=OTU, fill=log10_mean_rel_abd), color = "black") +
facet_grid(genus~tx_group, space="free", scales="free") +
theme_bw() +
theme(strip.text.y.right = element_text(angle = 0)) +
ylab("ZOTU") +
xlab("Day post-Co-housing") +
theme(strip.background=element_rect(fill="white")) +
theme(panel.spacing = unit(.05, "lines")) +
theme(panel.border = element_rect(color = "black", fill = NA, size = 1)) +
scale_fill_gradientn(colours = pal.colors,
guide = guide_colorbar(frame.colour = "black", ticks.colour = "black"))
rel.abd.heatmap
# Relative abundance heatmap : Day vs. OTU, color by log10 rel_abd
rel.abd.heatmap <- avg %>%
ggplot() +
geom_tile(aes(x=day, y=OTU, fill=log10_mean_rel_abd), color = "black") +
facet_grid(genus~tx_group, space="free", scales="free") +
theme_bw() +
theme(strip.text.y.right = element_text(angle = 0)) +
ylab("ZOTU") +
xlab("Day post-Co-housing") +
theme(strip.background=element_rect(fill="white")) +
theme(panel.spacing = unit(.0, "lines")) +
theme(panel.border = element_rect(color = "black", fill = NA, size = 1)) +
scale_fill_gradientn(colours = pal.colors,
guide = guide_colorbar(frame.colour = "black", ticks.colour = "black"))
rel.abd.heatmap
# Relative abundance heatmap : Day vs. OTU, color by log10 rel_abd
rel.abd.heatmap <- avg %>%
ggplot() +
geom_tile(aes(x=day, y=OTU, fill=log10_mean_rel_abd), color = "black") +
facet_grid(genus~tx_group, space="free", scales="free") +
theme_bw() +
theme(strip.text.y.right = element_text(angle = 0)) +
ylab("ZOTU") +
xlab("Day post-Co-housing") +
theme(strip.background=element_rect(fill="white")) +
theme(panel.spacing = unit(.025, "lines")) +
theme(panel.border = element_rect(color = "black", fill = NA, size = 1)) +
scale_fill_gradientn(colours = pal.colors,
guide = guide_colorbar(frame.colour = "black", ticks.colour = "black"))
rel.abd.heatmap
theme(strip.background=element_blank() +
# Relative abundance heatmap : Day vs. OTU, color by log10 rel_abd
rel.abd.heatmap <- avg %>%
ggplot() +
geom_tile(aes(x=day, y=OTU, fill=log10_mean_rel_abd), color = "black") +
facet_grid(genus~tx_group, space="free", scales="free") +
theme_bw() +
theme(strip.text.y.right = element_text(angle = 0)) +
ylab("ZOTU") +
xlab("Day post-Co-housing") +
theme(strip.background=element_blank()) +
theme(panel.spacing = unit(.025, "lines")) +
theme(panel.border = element_rect(color = "black", fill = NA, size = 1)) +
scale_fill_gradientn(colours = pal.colors,
guide = guide_colorbar(frame.colour = "black", ticks.colour = "black"))
rel.abd.heatmap
)
# Relative abundance heatmap : Day vs. OTU, color by log10 rel_abd
rel.abd.heatmap <- avg %>%
ggplot() +
geom_tile(aes(x=day, y=OTU, fill=log10_mean_rel_abd), color = "black") +
facet_grid(genus~tx_group, space="free", scales="free") +
theme_bw() +
ylab("ZOTU") +
xlab("Day post-Co-housing") +
scale_fill_gradientn(colours = pal.colors,
guide = guide_colorbar(frame.colour = "black", ticks.colour = "black")) +
theme(
strip.text.y.right = element_text(angle = 0),
strip.background=element_blank(),
panel.spacing = unit(0, "mm"),
panel.border = element_rect(color = "black", fill = NA, size = 1),
)
rel.abd.heatmap
# Relative abundance heatmap : Day vs. OTU, color by log10 rel_abd
rel.abd.heatmap <- avg %>%
ggplot() +
geom_tile(aes(x=day, y=OTU, fill=log10_mean_rel_abd), color = "black") +
facet_grid(.~tx_group, space="free", scales="free") +
theme_bw() +
ylab("ZOTU") +
xlab("Day post-Co-housing") +
scale_fill_gradientn(colours = pal.colors,
guide = guide_colorbar(frame.colour = "black", ticks.colour = "black")) +
theme(
strip.text.y.right = element_text(angle = 0),
strip.background=element_blank(),
panel.spacing = unit(0, "mm"),
panel.border = element_rect(color = "black", fill = NA, size = 1),
)
rel.abd.heatmap
# Relative abundance heatmap : Day vs. OTU, color by log10 rel_abd
rel.abd.heatmap <- avg %>%
ggplot() +
geom_tile(aes(x=day, y=OTU, fill=log10_mean_rel_abd), color = "black") +
facet_grid(.~tx_group, space="free", scales="free") +
theme_bw() +
ylab("ZOTU") +
xlab("Day post-Co-housing") +
scale_fill_gradientn(colours = pal.colors,
guide = guide_colorbar(frame.colour = "black", ticks.colour = "black")) +
theme(
strip.text.y.right = element_text(angle = 0),
strip.background=element_blank(),
panel.spacing = unit(0, "mm"),
panel.border = element_rect(color = "black", fill = NA, size = 1),
)
rel.abd.heatmap
avg
View(filtered.zotu)
exp.set <- J0 %>%
bind_rows(E0) %>%
bind_rows(JE) %>%
mutate(log10_rel_abd = if_else(rel_abd == 0, -5, log10(mean_rel_abd)))
exp.set <- J0 %>%
bind_rows(E0) %>%
bind_rows(JE) %>%
mutate(log10_rel_abd = if_else(rel_abd == 0, -5, log10(rel_abd)))
exp.set
exp.set %>%
pivot_wider(id_cols = "seqid", names_from = "OTU", values_from = "rel_abd")
View(exp.set)
exp.matrix <- exp.set %>%
pivot_wider(id_cols = "seqid", names_from = "OTU", values_from = "rel_abd")
View(exp.matrix)
heatmap(exp.matrix)
View(exp.matrix)
exp.matrix <- exp.set %>%
pivot_wider(id_cols = "seqid", names_from = "OTU", values_from = "rel_abd") %>%
column_to_rownames(var = "seqid")
View(exp.matrix)
exp.matrix <- exp.set %>%
pivot_wider(id_cols = "seqid", names_from = "OTU", values_from = "rel_abd") %>%
column_to_rownames(var = "seqid") %>%
as.matrix()
View(exp.matrix)
heatmap(exp.matrix)
exp.matrix <- exp.set %>%
pivot_wider(id_cols = "seqid", names_from = "OTU", values_from = "log10_rel_abd") %>%
column_to_rownames(var = "seqid") %>%
as.matrix()
heatmap(exp.matrix)
library("RColorBrewer")
colorRampPalette(pal.colors))(256)
colorRampPalette(pal.colors)(256)
# Prepare palette colors
pal.colors <- c("#647CBD", "#DBDDE0", "#E0624E")
pal <- colorRampPalette(pal.colors)(256)
heatmap(exp.matrix)
heatmap(exp.matrix, col = pal)
heatmap(t(exp.matrix), col = pal)
pal <- colorRampPalette(pal.colors)(128)
heatmap(t(exp.matrix), col = pal)
# Relative abundance heatmap : Day vs. OTU, color by log10 rel_abd
rel.abd.heatmap <- avg %>%
ggplot() +
geom_tile(aes(x=day, y=OTU, fill=log10_mean_rel_abd), color = "black") +
facet_grid(.~tx_group, space="free", scales="free") +
theme_bw() +
ylab("ZOTU") +
xlab("Day post-Co-housing") +
scale_fill_gradientn(colours = pal.colors,
guide = guide_colorbar(frame.colour = "black", ticks.colour = "black")) +
theme(
strip.text.y.right = element_text(angle = 0),
strip.background=element_blank(),
panel.spacing = unit(0, "mm"),
panel.border = element_rect(color = "black", fill = NA, size = 1),
)
rel.abd.heatmap
heatmap(t(exp.matrix), col = pal)
# Relative abundance heatmap : Day vs. OTU, color by log10 rel_abd
rel.abd.heatmap <- avg %>%
ggplot() +
geom_tile(aes(x=day, y=OTU, fill=log10_mean_rel_abd), color = "black") +
facet_grid(.~tx_group, space="free", scales="free") +
theme_bw() +
ylab("ZOTU") +
xlab("Day post-Co-housing") +
scale_fill_gradientn(colours = pal.colors,
guide = guide_colorbar(frame.colour = "black", ticks.colour = "black")) +
theme(
strip.text.y.right = element_text(angle = 0),
strip.background=element_blank(),
panel.spacing = unit(0, "mm"),
panel.border = element_rect(color = "black", fill = NA, size = 1),
)
rel.abd.heatmap
heatmap(t(exp.matrix), col = pal)
pal <- colorRampPalette(pal.colors)(50)
heatmap(t(exp.matrix), col = pal)
J <- filtered.zotu %>%
filter(tx_group == "jax_control")
E <- filtered.zotu %>%
filter(tx_group == "envigo_control")
JE <- filtered.zotu %>%
filter(tx_group == "jax_envigo_mix") %>%
filter(mouse_type == "jax")
exp.set <- J %>%
bind_rows(E) %>%
bind_rows(JE) %>%
mutate(log10_rel_abd = if_else(rel_abd == 0, -5, log10(rel_abd)))
exp.matrix <- exp.set %>%
pivot_wider(id_cols = "seqid", names_from = "OTU", values_from = "log10_rel_abd") %>%
column_to_rownames(var = "seqid") %>%
as.matrix()
# Prepare palette colors
pal.colors <- c("#647CBD", "#DBDDE0", "#E0624E")
pal <- colorRampPalette(pal.colors)(50)
heatmap(t(exp.matrix), col = pal)
View(exp.matrix)
pal <- colorRampPalette(pal.colors)(256)
heatmap(t(exp.matrix), col = pal)
# Prepare palette colors
pal.colors <- c("#647CBD", "#DBDDE0", "#E0624E")
pal <- colorRampPalette(pal.colors)(256)
heatmap(t(exp.matrix), col = pal)
exp.set <- J %>%
bind_rows(E) %>%
bind_rows(JE) %>%
mutate(log10_rel_abd = if_else(rel_abd == 0, -5, log10(rel_abd)))
exp.matrix <- exp.set %>%
pivot_wider(id_cols = "seqid", names_from = "OTU", values_from = "log10_rel_abd") %>%
column_to_rownames(var = "seqid") %>%
as.matrix()
# Prepare palette colors
pal.colors <- c("#647CBD", "#DBDDE0", "#E0624E")
pal <- colorRampPalette(pal.colors)(256)
heatmap(t(exp.matrix), col = pal)
pal <- colorRampPalette(pal.colors)(10)
heatmap(t(exp.matrix), col = pal)
pal <- colorRampPalette(pal.colors)(256)
heatmap(t(exp.matrix), col = pal)
# Relative abundance heatmap : Day vs. OTU, color by log10 rel_abd
rel.abd.heatmap <- avg %>%
ggplot() +
geom_tile(aes(x=day, y=OTU, fill=log10_mean_rel_abd), color = "black") +
facet_grid(.~tx_group, space="free", scales="free") +
theme_bw() +
ylab("ZOTU") +
xlab("Day post-Co-housing") +
scale_fill_gradientn(colours = pal.colors,
guide = guide_colorbar(frame.colour = "black", ticks.colour = "black")) +
theme(
strip.text.y.right = element_text(angle = 0),
strip.background=element_blank(),
panel.spacing = unit(0, "mm"),
panel.border = element_rect(color = "black", fill = NA, size = 1),
)
rel.abd.heatmap
# Create list of OTUs filtered to certain average abundance at day 0
# done independently for both Jax & Envigo, then merged and unique'd
filter.level <- .005
filtered.OTUs <- zotu %>%
filter(day == 0) %>%
filter(tx_group %in% c("jax_control", "envigo_control")) %>%
group_by(mouse_type, OTU) %>%
summarise(mean_rel_abd = mean(rel_abd), .groups = "drop") %>%
filter(mean_rel_abd > filter.level) %>%
select(OTU) %>%
unique() %>%
as_vector()
filtered.zotu <- zotu %>%
filter(OTU %in% filtered.OTUs)
J <- filtered.zotu %>%
filter(tx_group == "jax_control")
E <- filtered.zotu %>%
filter(tx_group == "envigo_control")
JE <- filtered.zotu %>%
filter(tx_group == "jax_envigo_mix") %>%
filter(mouse_type == "jax")
exp.set <- J %>%
bind_rows(E) %>%
bind_rows(JE) %>%
mutate(log10_rel_abd = if_else(rel_abd == 0, -5, log10(rel_abd)))
exp.matrix <- exp.set %>%
pivot_wider(id_cols = "seqid", names_from = "OTU", values_from = "log10_rel_abd") %>%
column_to_rownames(var = "seqid") %>%
as.matrix()
# Prepare palette colors
pal.colors <- c("#647CBD", "#DBDDE0", "#E0624E")
pal <- colorRampPalette(pal.colors)(256)
heatmap(t(exp.matrix), col = pal)
pal.colors <- c("#647CBD", "#E0624E")
pal <- colorRampPalette(pal.colors)(256)
heatmap(t(exp.matrix), col = pal)
View(exp.matrix)
