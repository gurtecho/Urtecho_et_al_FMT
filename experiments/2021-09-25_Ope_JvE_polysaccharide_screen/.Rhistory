ggplot() +
geom_histogram(aes(log10_rel_abd))
tidy.otu %>%
filter(species == "s__Agathobaculum_butyriciproducens") %>%
ggplot() +
geom_histogram(aes(log10_rel_abd))
tidy.otu %>%
filter(species == "s__Anaerotruncus_sp_CAG_528") %>%
ggplot() +
geom_histogram(aes(log10_rel_abd))
tidy.otu %>%
filter(species == "s__Flavonifractor_plautii") %>%
ggplot() +
geom_histogram(aes(log10_rel_abd))
tidy.otu %>%
filter(species == "s__Eubacterium_siraeum") %>%
ggplot() +
geom_histogram(aes(log10_rel_abd))
# Look at mean relative abundance of given species in the Ruminococcaceae family
tidy.otu %>%
group_by(family, genus, species) %>%
summarize(mean_rel_abd = mean(rel_abd), .groups = "drop") %>%
filter(mean_rel_abd > .1) %>%
filter(family == "f__Ruminococcaceae")
tidy.otu %>%
filter(species == "s__Ruminococcus_bromii") %>%
ggplot() +
geom_histogram(aes(log10_rel_abd))
tidy.otu %>%
filter(species == "s__Ruminococcus_bicirculans") %>%
ggplot() +
geom_histogram(aes(log10_rel_abd))
tidy.otu %>%
filter(species == "s__Gemmiger_formicili") %>%
ggplot() +
geom_histogram(aes(log10_rel_abd))
tidy.otu %>%
filter(species == "s__Gemmiger_formicili") %>%
ggplot() +
geom_histogram(aes(log10_rel_abd))
# Look at mean relative abundance of given species in the Ruminococcaceae family
tidy.otu %>%
group_by(family, genus, species) %>%
summarize(mean_rel_abd = mean(rel_abd), .groups = "drop") %>%
filter(mean_rel_abd > .1) %>%
filter(family == "f__Ruminococcaceae")
tidy.otu %>%
filter(species == "s__Gemmiger_formicilis") %>%
ggplot() +
geom_histogram(aes(log10_rel_abd))
tidy.otu %>%
filter(species == "s__Ruminococcus_lactaris") %>%
ggplot() +
geom_histogram(aes(log10_rel_abd))
tidy.otu %>%
filter(species == "s__Ruminococcus_sp_CAG_488") %>%
ggplot() +
geom_histogram(aes(log10_rel_abd))
sampleMetadata %>%
filter(study_name == "ZeeviD_2015")
sampleMetadata %>%
filter(study_name == "ZeeviD_2015") %>%
select(sample_id, subject_id, body_site)
sampleMetadata
rm(list=ls())
#hmp2012 <- curatedMetagenomicData("HMP_2012.relative_abundance", dryrun = FALSE)[[1]]
zeevi2015 <- curatedMetagenomicData("ZeeviD_2015.relative_abundance", dryrun = FALSE)[[1]]
# Pull out pseudo-OTU table
#otu <- assays(hmp2012)[[1]]
otu <- assays(zeevi2015)[[1]]
# Pull taxonomy info from table
taxonomy <- rownames(otu) %>%
as_tibble() %>%
rename(tax = value) %>%
separate(tax, into = c("k", "p", "c", "o", "family", "genus", "species"), sep = "([|])") %>%
select(family, genus, species)
# Convert to tibble; end up losing tax column, add it back in w/ bind_columns
otu <- as_tibble(otu) %>%
bind_cols(taxonomy)
# Create tidy otu table
tidy.otu <- otu %>%
pivot_longer(!c(family, genus, species), names_to = "sample", values_to = "rel_abd") %>%
mutate(log10_rel_abd = if_else(rel_abd > 0, log10(rel_abd), -5))
# Look at mean relative abundance of given species in the Ruminococcaceae family
tidy.otu %>%
group_by(family, genus, species) %>%
summarize(mean_rel_abd = mean(rel_abd), .groups = "drop") %>%
filter(mean_rel_abd > .1) %>%
filter(family == "f__Ruminococcaceae")
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(log10_rel_abd))
# filter tidy otu to only look at species at >= .1% relative abundance
tidy.otu %>%
group_by(family, genus, species) %>%
summarize(mean_rel_abd = mean(rel_abd), .groups = "drop") %>%
filter(mean_rel_abd > .1)
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(log10_rel_abd))
# filter tidy otu to only look at species at >= .1% relative abundance
tidy.otu <- tidy.otu %>%
group_by(family, genus, species) %>%
summarize(mean_rel_abd = mean(rel_abd), .groups = "drop") %>%
filter(mean_rel_abd > .1)
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(log10_rel_abd))
# Create tidy otu table
tidy.otu <- otu %>%
pivot_longer(!c(family, genus, species), names_to = "sample", values_to = "rel_abd") %>%
mutate(log10_rel_abd = if_else(rel_abd > 0, log10(rel_abd), -5))
# filter tidy otu to only look at species at >= .1% relative abundance
tidy.otu %>%
group_by(family, genus, species) %>%
summarize(mean_rel_abd = mean(rel_abd), .groups = "drop") %>%
filter(mean_rel_abd > .1)
# filter tidy otu to only look at species at >= .1% relative abundance
tidy.otu %>%
group_by(family, genus, species) %>%
summarize(mean_rel_abd = mean(rel_abd), .groups = "drop") %>%
filter(mean_rel_abd > .1) %>%
select(species) %>%
as_vector()
# filter tidy otu to only look at species at >= .1% relative abundance
species.to.keep <- tidy.otu %>%
group_by(family, genus, species) %>%
summarize(mean_rel_abd = mean(rel_abd), .groups = "drop") %>%
filter(mean_rel_abd > .1) %>%
select(species) %>%
as_vector()
tidy.otu
# Pull out pseudo-OTU table
#otu <- assays(hmp2012)[[1]]
otu <- assays(zeevi2015)[[1]]
# Pull taxonomy info from table
taxonomy <- rownames(otu) %>%
as_tibble() %>%
rename(tax = value) %>%
separate(tax, into = c("k", "p", "c", "o", "family", "genus", "species"), sep = "([|])") %>%
select(family, genus, species)
# Convert to tibble; end up losing tax column, add it back in w/ bind_columns
otu <- as_tibble(otu) %>%
bind_cols(taxonomy)
# Create tidy otu table
tidy.otu <- otu %>%
pivot_longer(!c(family, genus, species), names_to = "sample", values_to = "rel_abd") %>%
mutate(log10_rel_abd = if_else(rel_abd > 0, log10(rel_abd), -5))
# filter tidy otu to only look at species at >= .1% relative abundance
species.to.keep <- tidy.otu %>%
group_by(family, genus, species) %>%
summarize(mean_rel_abd = mean(rel_abd), .groups = "drop") %>%
filter(mean_rel_abd > .1) %>%
select(species) %>%
as_vector()
tidy.otu
tidy.otu %>%
filter(species %in% species.to.keep)
tidy.otu <- tidy.otu %>%
filter(species %in% species.to.keep)
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(log10_rel_abd))
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(log10_rel_abd), binwidth = 0.5)
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(log10_rel_abd), binwidth = 0.125)
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(log10_rel_abd), binwidth = 0.25)
# Create tidy otu table
tidy.otu <- otu %>%
pivot_longer(!c(family, genus, species), names_to = "sample", values_to = "rel_abd") %>%
mutate(log10_rel_abd = if_else(rel_abd > 0, log10(rel_abd), -5))
# filter tidy otu to only look at species at >= .1% relative abundance
species.to.keep <- tidy.otu %>%
group_by(family, genus, species) %>%
summarize(mean_rel_abd = mean(rel_abd), .groups = "drop") %>%
filter(mean_rel_abd > 1) %>%
select(species) %>%
as_vector()
tidy.otu <- tidy.otu %>%
filter(species %in% species.to.keep)
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(log10_rel_abd), binwidth = 0.25) %>%
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_boxplot(aes(x=genus, y=log10_rel_abd),)
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(log10_rel_abd), binwidth = 0.25)
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") #%>%
# Look at rumino abd
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
group_by(genus, species) %>%
summarize(mean_rel_abd = mean(rel_abd), .groups = "drop")
# Create tidy otu table
tidy.otu <- otu %>%
pivot_longer(!c(family, genus, species), names_to = "sample", values_to = "rel_abd") %>%
mutate(log10_rel_abd = if_else(rel_abd > 0, log10(rel_abd), -5))
# filter tidy otu to only look at species at >= .1% relative abundance
species.to.keep <- tidy.otu %>%
group_by(family, genus, species) %>%
summarize(mean_rel_abd = mean(rel_abd), .groups = "drop") %>%
filter(mean_rel_abd > .5) %>%
select(species) %>%
as_vector()
tidy.otu <- tidy.otu %>%
filter(species %in% species.to.keep)
# Look at rumino abd
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
group_by(genus, species) %>%
summarize(mean_rel_abd = mean(rel_abd), .groups = "drop")
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(log10_rel_abd), binwidth = 0.25)
# Create tidy otu table
tidy.otu <- otu %>%
pivot_longer(!c(family, genus, species), names_to = "sample", values_to = "rel_abd") %>%
mutate(log10_rel_abd = if_else(rel_abd > 0, log10(rel_abd), -5))
# filter tidy otu to only look at species at >= .1% relative abundance
species.to.keep <- tidy.otu %>%
group_by(family, genus, species) %>%
summarize(mean_rel_abd = mean(rel_abd), .groups = "drop") %>%
filter(mean_rel_abd > .1) %>%
select(species) %>%
as_vector()
tidy.otu <- tidy.otu %>%
filter(species %in% species.to.keep)
# Look at rumino abd
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
group_by(genus, species) %>%
summarize(mean_rel_abd = mean(rel_abd), .groups = "drop")
rm(list=ls())
hmp2012 <- curatedMetagenomicData("HMP_2012.relative_abundance", dryrun = FALSE)[[1]]
# Pull out pseudo-OTU table
otu <- assays(hmp2012)[[1]]
# Pull taxonomy info from table
taxonomy <- rownames(otu) %>%
as_tibble() %>%
rename(tax = value) %>%
separate(tax, into = c("k", "p", "c", "o", "family", "genus", "species"), sep = "([|])") %>%
select(family, genus, species)
# Convert to tibble; end up losing tax column, add it back in w/ bind_columns
otu <- as_tibble(otu) %>%
bind_cols(taxonomy)
# Create tidy otu table
tidy.otu <- otu %>%
pivot_longer(!c(family, genus, species), names_to = "sample", values_to = "rel_abd") %>%
mutate(log10_rel_abd = if_else(rel_abd > 0, log10(rel_abd), -5))
# filter tidy otu to only look at species at >= .1% relative abundance
species.to.keep <- tidy.otu %>%
group_by(family, genus, species) %>%
summarize(mean_rel_abd = mean(rel_abd), .groups = "drop") %>%
filter(mean_rel_abd > .1) %>%
select(species) %>%
as_vector()
tidy.otu <- tidy.otu %>%
filter(species %in% species.to.keep)
# Look at rumino abd
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
group_by(genus, species) %>%
summarize(mean_rel_abd = mean(rel_abd), .groups = "drop")
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(log10_rel_abd), binwidth = 0.25)
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes((..log10_rel_abd..)/sum(..log10_rel_abd..)), binwidth = 0.25)
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(x = log10_rel_abd, y = (..count..)/sum(..count..)), binwidth = 0.25)
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(x = log10_rel_abd, y = (..count..)/sum(..count..)), binwidth = 0.25)
#hmp2012 <- curatedMetagenomicData("HMP_2012.relative_abundance", dryrun = FALSE)[[1]]
zeevi2015 <- curatedMetagenomicData("ZeeviD_2015.relative_abundance", dryrun = FALSE)[[1]]
# Pull out pseudo-OTU table
otu <- assays(hmp2012)[[1]]
# Pull taxonomy info from table
taxonomy <- rownames(otu) %>%
as_tibble() %>%
rename(tax = value) %>%
separate(tax, into = c("k", "p", "c", "o", "family", "genus", "species"), sep = "([|])") %>%
select(family, genus, species)
# Convert to tibble; end up losing tax column, add it back in w/ bind_columns
otu <- as_tibble(otu) %>%
bind_cols(taxonomy)
# Create tidy otu table
tidy.otu <- otu %>%
pivot_longer(!c(family, genus, species), names_to = "sample", values_to = "rel_abd") %>%
mutate(log10_rel_abd = if_else(rel_abd > 0, log10(rel_abd), -5))
# filter tidy otu to only look at species at >= .1% relative abundance
species.to.keep <- tidy.otu %>%
group_by(family, genus, species) %>%
summarize(mean_rel_abd = mean(rel_abd), .groups = "drop") %>%
filter(mean_rel_abd > .1) %>%
select(species) %>%
as_vector()
tidy.otu <- tidy.otu %>%
filter(species %in% species.to.keep)
# Look at rumino abd
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
group_by(genus, species) %>%
summarize(mean_rel_abd = mean(rel_abd), .groups = "drop")
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(x = log10_rel_abd, y = (..count..)/sum(..count..)), binwidth = 0.25)
rm(list=ls())
#hmp2012 <- curatedMetagenomicData("HMP_2012.relative_abundance", dryrun = FALSE)[[1]]
zeevi2015 <- curatedMetagenomicData("ZeeviD_2015.relative_abundance", dryrun = FALSE)[[1]]
# Pull out pseudo-OTU table
#otu <- assays(hmp2012)[[1]]
otu <- assays(zeevi2015)[[1]]
# Pull taxonomy info from table
taxonomy <- rownames(otu) %>%
as_tibble() %>%
rename(tax = value) %>%
separate(tax, into = c("k", "p", "c", "o", "family", "genus", "species"), sep = "([|])") %>%
select(family, genus, species)
# Convert to tibble; end up losing tax column, add it back in w/ bind_columns
otu <- as_tibble(otu) %>%
bind_cols(taxonomy)
# Create tidy otu table
tidy.otu <- otu %>%
pivot_longer(!c(family, genus, species), names_to = "sample", values_to = "rel_abd") %>%
mutate(log10_rel_abd = if_else(rel_abd > 0, log10(rel_abd), -5))
# filter tidy otu to only look at species at >= .1% relative abundance
species.to.keep <- tidy.otu %>%
group_by(family, genus, species) %>%
summarize(mean_rel_abd = mean(rel_abd), .groups = "drop") %>%
filter(mean_rel_abd > .1) %>%
select(species) %>%
as_vector()
tidy.otu <- tidy.otu %>%
filter(species %in% species.to.keep)
# Look at rumino abd
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
group_by(genus, species) %>%
summarize(mean_rel_abd = mean(rel_abd), .groups = "drop")
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(x = log10_rel_abd, y = (..count..)/sum(..count..)), binwidth = 0.25)
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(x = log10_rel_abd, y = (..count..)/sum(..count..)), binwidth = 0.25) +
facet_grid(genus~.)
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(x = log10_rel_abd, y = (..count..)/sum(..count..)), binwidth = 0.25) +
facet_grid(genus~.) +
theme(strip.text.y = element_text(angle=90))
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(x = log10_rel_abd, y = (..count..)/sum(..count..)), binwidth = 0.25) +
facet_grid(genus~.) +
theme(strip.text.y = element_text(angle=0))
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(x = log10_rel_abd, y = (..count..)/sum(..count..)), binwidth = 0.25) +
facet_grid(genus~., scales = "free") +
theme(strip.text.y = element_text(angle=0))
# Look at distribution of Ruminococcaceae species relative abundance
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
ggplot() +
geom_histogram(aes(x = log10_rel_abd, y = (..count..)/sum(..count..)), binwidth = 0.25) +
facet_grid(genus~.) +
theme(strip.text.y = element_text(angle=0))
# Look at rumino abd
tidy.otu %>%
filter(family == "f__Ruminococcaceae") %>%
group_by(genus, species) %>%
summarize(mean_rel_abd = mean(rel_abd), .groups = "drop")
# Look at distribution of individual Ruminococcaceae species log10 relative abundance
tidy.otu %>%
filter(species == "s__Agathobaculum_butyriciproducens") %>%
ggplot() +
geom_histogram(aes(x = log10_rel_abd, y = (..count..)/sum(..count..)), binwidth = 0.25) +
facet_grid(genus~.) +
theme(strip.text.y = element_text(angle=0))
library(tidyverse)
library(vegan)
install.packages("vegan")
library(vegan)
data(varespec)
View(varespec)
sum(varespec)
View(varespec)
varespec %>%
sum(Callvulg)
library(tidyverse)
varespec %>%
sum(Callvulg)
varespec %>%
sum(Callvulg)
varespec %>%
summarise(total = sum(Callvulg))
View(varespec)
varespec %>%
summarise(total = sum(Rhodtome))
# Set wd to parent experiment folder
setwd("~/Dropbox/projects/fmt/experiments/2021-09-25_Ope_JvE_polysaccharide_screen/")
lotu <- read_csv("data/lotu.csv")
View(lotu)
lotu %>%
pivot_wider(id_cols = "seqid")
lotu %>%
pivot_wider(id_cols = "seqid", names_from = "OTU")
lotu %>%
pivot_wider(id_cols = "seqid", names_from = "OTU", values_from = "rel_abd")
community.matrix <- lotu %>%
pivot_wider(id_cols = "seqid", names_from = "OTU", values_from = "rel_abd")
distance.matric <- community.matrix %>%
vegdist()
distance.matric <- community.matrix %>%
as.matrix() %>%
vegdist()
View(community.matrix)
distance.matric <- community.matrix %>%
as.matrix()
data("varespec")
View(distance.matric)
distance.matrix
distance.matrix <- community.matrix %>%
as.matrix()
distance.matrix
typeof(distance.matrix)
View(distance.matrix)
test <- data("varespec")
test <- data("varespec")
View(varespec)
community.matrix <- lotu %>%
select(-seqid) %>%
pivot_wider(id_cols = "seqid", names_from = "OTU", values_from = "rel_abd")
View(lotu)
community.matrix <- lotu %>%
select(-seqid) %>%
pivot_wider(id_cols = "seqid", names_from = "OTU", values_from = "rel_abd")
distance.matrix <- community.matrix %>%
select(-seqid) %>%
as.matrix()
distance.matrix
distance.matrix %>%
vegdist()
distance.matrix <- community.matrix %>%
select(-seqid) %>%
as.matrix() %>%
vegdist()
rm(list=ls())
# Set wd to parent experiment folder
setwd("~/Dropbox/projects/fmt/experiments/2021-09-25_Ope_JvE_polysaccharide_screen/")
lotu <- read_csv("data/lotu.csv")
community.matrix <- lotu %>%
pivot_wider(id_cols = "seqid", names_from = "OTU", values_from = "rel_abd")
distance.matrix <- community.matrix %>%
select(-seqid) %>%
as.matrix() %>%
vegdist()
distance.matrix
