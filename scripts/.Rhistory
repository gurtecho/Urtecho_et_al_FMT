geom_jitter(aes(color= module_category)) +
theme_clean() + #facet_wrap(~family)
scale_color_manual(values = vendor_cols) +
geom_signif(comparisons = list(c("AZC3J", "AZC7E")),
map_signif_level = F,
test = "wilcox.test",
test.args='greater') + labs(x = '', y = 'Community-level Module Completeness') +
theme(axis.text = element_text(size = 14),
axis.title = element_text(size = 14), legend.title = element_blank())
#Look at indepen
independence_completeness %>% select(group, module, module_category, percentage) %>% distinct() %>%
ggplot(., aes(group, percentage)) +
stat_boxplot(geom = 'errorbar', width = .15) +
geom_boxplot(outlier.shape = NA, width = .35) +
geom_jitter(aes(color= module_category)) +
theme_clean() + #facet_wrap(~family)
#scale_color_manual(values = vendor_cols) +
geom_signif(comparisons = list(c("AZC3J", "AZC7E")),
map_signif_level = F,
test = "wilcox.test",
test.args='greater') + labs(x = '', y = 'Community-level Module Completeness') +
theme(axis.text = element_text(size = 14),
axis.title = element_text(size = 14), legend.title = element_blank())
#Look at indepen
independence_completeness %>% select(group, module, module_category, percentage) %>% distinct() %>%
ggplot(., aes(group, percentage)) +
stat_boxplot(geom = 'errorbar', width = .15) +
geom_boxplot(outlier.shape = NA, width = .35) +
geom_jitter(aes(color= module_category)) +
theme_clean() + #facet_wrap(~family)
#scale_color_manual(values = vendor_cols) +
geom_signif(comparisons = list(c("AZC3J", "AZC7E")),
map_signif_level = F,
test = "wilcox.test") + labs(x = '', y = 'Community-level Module Completeness') +
theme(axis.text = element_text(size = 14),
axis.title = element_text(size = 14), legend.title = element_blank())
library(RColorBrewer)
#Look at indepen
independence_completeness %>%
select(group, module, module_category, percentage) %>%
distinct() %>%
ggplot(aes(x = group, y = percentage)) +
stat_boxplot(geom = 'errorbar', width = .15) +
geom_boxplot(outlier.shape = NA, width = .35) +
geom_jitter(aes(color = module_category), position = position_jitter(width = 0.2)) +
scale_color_brewer(palette = "Set1") +
theme_minimal() + # Replacing theme_clean() with theme_minimal() for demonstration
geom_signif(comparisons = list(c("AZC3J", "AZC7E")),
map_signif_level = FALSE,
test = "wilcox.test") +
labs(x = '', y = 'Community-level Module Completeness') +
theme(axis.text = element_text(size = 14),
axis.title = element_text(size = 14),
legend.title = element_blank())
#Look at indepen
independence_completeness %>%
select(group, module, module_category, percentage) %>%
distinct() %>%
ggplot(aes(x = group, y = percentage)) +
stat_boxplot(geom = 'errorbar', width = .15) +
geom_boxplot(outlier.shape = NA, width = .35) +
geom_jitter(aes(color = module_category), position = position_jitter(width = 0.2)) +
scale_color_brewer(palette = "Set1") +
theme_cowplot() +
geom_signif(comparisons = list(c("AZC3J", "AZC7E")),
map_signif_level = FALSE,
test = "wilcox.test") +
labs(x = '', y = 'Community-level Module Completeness') +
theme(axis.text = element_text(size = 14),
axis.title = element_text(size = 14),
legend.title = element_blank())
ggsave("../processed_data/ModuleCompleteness.pdf", width = 4, height = 3)
independence <- read.csv('../processed_data/genome_score_family.csv', header = T, sep = ',')
independence %>% ggplot(., aes(group, score)) +
stat_boxplot(geom = 'errorbar', width = .15) +
geom_boxplot(outlier.shape = NA, width = .35) +
geom_jitter(aes(color=group)) + theme_clean() + #facet_wrap(~family)
scale_color_manual(values = vendor_cols) +
geom_signif(comparisons = list(c("AZC3J", "AZC7E")),
map_signif_level = F,
test = "wilcox.test",
test.args='greater') + labs(x = '', y = 'Metabolic Independence') +
theme(axis.text = element_text(size = 14),
axis.title = element_text(size = 14), legend.title = element_blank())
View(independence)
independence
data %>% select(order, family, id, cohort, totalLength) %>%
# filter(cohort == 'AZC3J' | cohort == 'AZC7E') %>%
mutate(totalLength = totalLength/1000000) %>%
distinct() %>%
filter(family == 'Muribaculaceae'| family == 'Bacteroidaceae') %>%
#  filter(order == 'Bacteroidales') %>%
ggplot(., aes(cohort, totalLength,)) +
stat_boxplot(geom = 'errorbar', width = .15) +
geom_boxplot(outlier.shape = NA, width = .35) +
geom_jitter(aes(color=cohort)) +
theme_clean() + #facet_wrap(~family)
scale_color_manual(values = vendor_cols) +
geom_signif(comparisons = list(c("AZC3J", "AZC7E")),
map_signif_level = F,
test = "wilcox.test",
test.args='greater') + labs(x = '', y = 'MAG Size (Mbp)') +
theme(axis.text = element_text(size = 14),
axis.title = element_text(size = 14), legend.title = element_blank())
ggsave("../processed_data/MAGsizes.pdf", width = 4, height = 3)
independence_completeness <- read.csv("../processed_data/enrichment_score_vs_module.csv")
#Look at completeness of modules
independence_completeness %>%
select(group, module, module_category, percentage) %>%
distinct() %>%
ggplot(aes(x = group, y = percentage)) +
stat_boxplot(geom = 'errorbar', width = .15) +
geom_boxplot(outlier.shape = NA, width = .35) +
geom_jitter(aes(color = module_category), position = position_jitter(width = 0.2)) +
scale_color_brewer(palette = "Set1") +
theme_cowplot() +
geom_signif(comparisons = list(c("AZC3J", "AZC7E")),
map_signif_level = FALSE,
test = "wilcox.test") +
labs(x = '', y = 'Community-level Module Completeness') +
theme(axis.text = element_text(size = 14),
axis.title = element_text(size = 14),
legend.title = element_blank())
ggsave("../processed_data/ModuleCompleteness.pdf", width = 7, height = 3)
ggsave("../figs/ModuleCompleteness.pdf", width = 7, height = 3)
ggsave("../figs/ModuleCompleteness.pdf", width = 7, height = 3.5)
independence <- read.csv('../processed_data/genome_score_family.csv', header = T, sep = ',')
independence %>% ggplot(., aes(group, score)) +
stat_boxplot(geom = 'errorbar', width = .15) +
geom_boxplot(outlier.shape = NA, width = .35) +
geom_jitter(aes(color=group)) + theme_clean() + #facet_wrap(~family)
scale_color_manual(values = vendor_cols) +
geom_signif(comparisons = list(c("AZC3J", "AZC7E")),
map_signif_level = F,
test = "wilcox.test",
test.args='greater') + labs(x = '', y = 'Metabolic Independence') +
theme(axis.text = element_text(size = 14),
axis.title = element_text(size = 14), legend.title = element_blank())
ggsave("../processed_data/MetabolicIndependence.pdf", width = 4, height = 3)
ggsave("../figs/MetabolicIndependence.pdf", width = 4, height = 3)
ggsave("../figs/MAGsizes.pdf", width = 4, height = 3)
data %>% select(order, family, id, cohort, totalLength) %>%
# filter(cohort == 'AZC3J' | cohort == 'AZC7E') %>%
mutate(totalLength = totalLength/1000000) %>%
distinct() %>%
filter(family == 'Muribaculaceae'| family == 'Bacteroidaceae') %>%
#  filter(order == 'Bacteroidales') %>%
ggplot(., aes(cohort, totalLength,)) +
stat_boxplot(geom = 'errorbar', width = .15) +
geom_boxplot(outlier.shape = NA, width = .35) +
geom_jitter(aes(color=cohort)) +
theme_clean() + #facet_wrap(~family)
scale_color_manual(values = vendor_cols) +
geom_signif(comparisons = list(c("AZC3J", "AZC7E")),
map_signif_level = F,
test = "wilcox.test",
test.args='greater') + labs(x = '', y = 'MAG Size (Mbp)') +
theme(axis.text = element_text(size = 14),
axis.title = element_text(size = 14), legend.title = element_blank())
ggsave("../figs/MAGsizes.pdf", width = 4, height = 3)
independence %>% ggplot(., aes(group, score)) +
stat_boxplot(geom = 'errorbar', width = .15) +
geom_boxplot(outlier.shape = NA, width = .35) +
geom_jitter(aes(color=group)) + theme_clean() + #facet_wrap(~family)
scale_color_manual(values = vendor_cols) +
geom_signif(comparisons = list(c("AZC3J", "AZC7E")),
map_signif_level = F,
test = "wilcox.test",
test.args='greater') + labs(x = '', y = 'Metabolic Independence') +
theme(axis.text = element_text(size = 14),
axis.title = element_text(size = 14), legend.title = element_blank())
ggsave("../figs/MetabolicIndependence.pdf", width = 4.2, height = 3)
ggsave("../figs/MetabolicIndependence.pdf", width = 4.1, height = 3)
knitr::opts_chunk$set(echo = TRUE)
setwd("/Users/guillaumeurtecho/Google_Drive/WangLab/Projects/RecodingProject/20230125_RECODE_NewLibraryGeneration/20231020_Full_Library/scripts/")
library(tidyverse)
library(wesanderson)
library(reshape2)
library(ggthemes)
library(cowplot)
library(phylotools)
library(Biostrings)
library(ggpubr)
#library(seqinr)
#library(devtools)
#source_url("https://raw.githubusercontent.com/lrjoshi/FastaTabular/master/fasta_and_tabular.R")
pal <- wes_palette("Zissou1", 100, type = "continuous")
#metadata <- read.csv("../misc/metadata.csv") %>%
#              separate(., sample, into = c('library','time','replicate'), sep = '_', remove = F)
options(stringsAsFactors = F)
options(scipen = 10000)
args = commandArgs(trailingOnly=TRUE)
#Define all library prefixes here, add new argument and library variable
args <- c('O2_1',
'O2_2',
'O31_1',
'O31_2',
'O2_combined',
'O31_combined')
#Lib1_prefix <- args[1]
#Lib2_prefix <- args[2]
#Lib3_prefix <- args[3]
#Lib4_prefix <- args[4]
knitr::opts_chunk$set(echo = TRUE)
setwd("/Users/guillaumeurtecho/Google_Drive/WangLab/Projects/RecodingProject/20230125_RECODE_NewLibraryGeneration/20231020_Full_Library/scripts/")
library(tidyverse)
library(wesanderson)
library(reshape2)
library(ggthemes)
library(cowplot)
library(phylotools)
library(Biostrings)
library(ggpubr)
#library(seqinr)
#library(devtools)
#source_url("https://raw.githubusercontent.com/lrjoshi/FastaTabular/master/fasta_and_tabular.R")
pal <- wes_palette("Zissou1", 100, type = "continuous")
#metadata <- read.csv("../misc/metadata.csv") %>%
#              separate(., sample, into = c('library','time','replicate'), sep = '_', remove = F)
options(stringsAsFactors = F)
options(scipen = 10000)
args = commandArgs(trailingOnly=TRUE)
#Define all library prefixes here, add new argument and library variable
args <- c('O2_1',
'O2_2',
'O31_1',
'O31_2',
'O2_combined',
'O31_combined')
#Lib1_prefix <- args[1]
#Lib2_prefix <- args[2]
#Lib3_prefix <- args[3]
#Lib4_prefix <- args[4]
# read in barcode count files
filelist = list.files(path = '../processed_data/barcode_counts',
pattern = '^counts_*',
full.names = T)
sample_names <- filelist %>% as.data.frame %>%
mutate(sample_names = gsub('../processed_data/barcode_counts/counts_', '',.)) %>%
separate(., sample_names, into = c('sample_names', 'fat'), sep = '_S') %>% select(sample_names)
#Read in dataframes
for(i in seq(1:length(filelist))) {
sample_name <- sample_names$sample_names[i]
x <- read.table(filelist[i], col.names=c(sample_name, 'barcode'), header = F)
#x <- subset(x, x[,1] > 1)   #Filter out barcodes with only one read in sample, already done in barcode_counts
names(x) <- c(sample_name, "barcode")
x[[sample_name]] <- 100000*x[sample_name]/sum(x[sample_name])  #Normalizes by RP100K
assign(sample_name, x)
names(sample_name)
}
#Need to remove dataframes with 0 observations, then merge all
# Get the names of all data frames in the global environment
df_names <- ls(pattern = "P")  # Replace "P" with your desired pattern
# Filter data frames with 0 observations
non_empty_df_names <- Filter(function(x) nrow(get(x)) > 0, df_names)
# Remove data frames with 0 observations
rm(list = setdiff(df_names, non_empty_df_names))
#List all remaining dataframes
count_list <- lapply(ls(pattern="P"), function(x) get(x))
#Merge dataframes
all_counts <-  count_list %>%
purrr::reduce(full_join, by = "barcode") %>%
do.call(data.frame, .) %>% filter(barcode != 'NNNNNNNNNNNNNNNNNNNN')
#correct name
names(all_counts) <- gsub(x = names(all_counts), pattern = "\\.", replacement = "_")
# Remove '.txt' from column names
names(all_counts) <- gsub("\\_txt", "", names(all_counts), ignore.case = TRUE)
print(paste("Number of unique sequenced barcodes, all replicates in DNA and RNA:", nrow(all_counts)))
# remove individual sample files
rm(list = sample_names$sample_names)
rm(count_list)
#Now combine different pools from each time point
#temp <- all_counts[1:1000,]
merged_df <- all_counts %>% melt(id.vars = 'barcode') %>% separate(variable, into = c('pool', 'time')) %>%
group_by(time, pool, barcode) %>% mutate(value = replace_na(value, 0),
total_value = round(sum(value), 2)) %>% ungroup() %>%
select(barcode, pool, time, total_value) %>% distinct() %>% dcast(barcode + pool ~ time, value.var = 'total_value')
bc_counts <- read.csv('../processed_data/barcode_counts_long.csv')
#Good candidates to look at?
candidates <- bc_counts %>% filter(num_barcodes > 5) %>% select(gene.name, Gene) %>%
distinct() %>% group_by(Gene) %>% mutate(num_var = n()) %>% ungroup() %>%
select(-gene.name) %>% distinct() %>% arrange(desc(num_var)) #%>% head(10) %>% select(Gene)
View(candidates)
knitr::opts_chunk$set(echo = TRUE)
setwd("~/Dropbox/fmt/scripts/")
library(tidyverse)
library(wesanderson)
library(ggthemes)
library(reshape2)
library(cowplot)
library(DESeq2)
library(cowplot)
ven <- c('#FAAF40',"#1B75BB","#37B34A", "#F05A28") #C,E,J,T
pal <- wes_palette("Zissou1", 100, type = "continuous")
options(stringsAsFactors = F)
options(scipen = 10000)
zotu <- read_csv("../seq/zotu.csv")
tax <- read_csv("../seq/tax.csv")
meta <- read_csv("../experiments/2021-03-18_JxE_FMT03/metadata/samples.csv")
# Check read counts
read.counts <- zotu %>%
rowwise(seqid) %>%
mutate(numreads = rowSums(across(where(is.numeric)))) %>%
ungroup() %>%
select(seqid, numreads)
# Pull out samples w/ >10k reads
samples.to.keep <- read.counts %>%
filter(numreads > 1000) %>%
select(seqid) %>%
as_vector()
# Drop <10k read samples from zotu table
zotu <- zotu %>%
filter(seqid %in% samples.to.keep)
# make tidy data
# Convert to relative abundance
zotu <- zotu %>%
pivot_longer(!seqid, names_to="OTU", values_to="reads") %>%
group_by(seqid) %>%
mutate(relabd = reads / sum(reads))
# Join metadata to zotu table
zotu <- zotu %>%
left_join(meta, by="seqid")
# Pull out OTUs at least 1% abd in either jax or envigo controls
jax.otus.to.keep <- zotu %>%
filter(tx_group == "jax_control") %>%
group_by(OTU) %>%
summarise(avg_abd = mean(relabd)) %>%
filter(avg_abd > .003) %>%
select(OTU) %>%
as_vector()
envigo.otus.to.keep <- zotu %>%
filter(tx_group == "envigo_control") %>%
group_by(OTU) %>%
summarise(avg_abd = mean(relabd)) %>%
filter(avg_abd > .003) %>%
select(OTU) %>%
as_vector()
otus.to.keep <- unique(c(jax.otus.to.keep, envigo.otus.to.keep))
# Drop OTUs not at least 1% abd
zotu <- zotu %>%
filter(OTU %in% otus.to.keep)
# calc log10 OTU abd
zotu <- zotu %>%
mutate(log10relabd = if_else(relabd == 0, -6, log10(relabd)))
otu.levels <- zotu %>%
filter(tx_group == "jax_control") %>%
filter(day == 0) %>%
arrange(desc(log10relabd)) %>%
group_by(OTU) %>%
summarise(mean_log10abd = median(log10relabd)) %>%
filter(OTU %in% jax.otus.to.keep) %>%
select(OTU) %>%
as_vector()
otu.levels <- c(otu.levels, setdiff(envigo.otus.to.keep, otu.levels))
zotu$OTU <- factor(zotu$OTU, levels = otu.levels)
zotu$day <- factor(zotu$day, levels = unique(zotu$day))
gtable <- tax %>%
select(OTU, genus, family)
zotu <- zotu %>%
left_join(gtable, by="OTU") %>%
mutate(otu_genus = paste(OTU, genus, sep="_"))
controls <- zotu %>%
filter(tx_group %in% c("jax_control", "envigo_control"))
jax_tx <- zotu %>%
filter(tx_group == "jax_envigo_mix") %>%
filter(mouse_type == "jax")
env_tx <- zotu %>%
filter(tx_group == "jax_envigo_mix") %>%
filter(mouse_type == "envigo") %>% mutate(tx_group = 'envigo_jax_mix')
zotu <- bind_rows(controls, jax_tx, env_tx) #Lost envigo at this point
zotu[zotu == "envigo_control"] <- "Envigo Control"
zotu[zotu == "envigo_jax_mix"] <- "Envigo Cohoused"
zotu[zotu == "jax_control"] <- "Jax Control"
zotu[zotu == "jax_envigo_mix"] <- "Jax Cohoused"
#Normalize to sporosarcina + weight
normalizer <-  zotu %>% filter(OTU == 'Otu1') %>% select(seqid, 'sporo_abd' = relabd)
#get average to normalize everything
med_sporo <- median(normalizer$sporo_abd)
med_poopoo <- median(na.omit(meta$pellet_weight))
norm_zotu <- left_join(zotu, normalizer, by = 'seqid') %>%
mutate(abs_reads = ifelse(relabd==0, 0,
(((relabd/sporo_abd)*med_sporo)/pellet_weight)*med_poopoo)) %>% #divide by sporo abundance and multiply by med_sporo (scaling factor)
group_by(seqid) %>%
mutate(abs_rel_abundance = abs_reads/sum(abs_reads),
log10abs_rel_abundance = if_else(abs_rel_abundance == 0, -5, log10(abs_rel_abundance))) %>% ungroup()
#arrange day
norm_zotu <- norm_zotu %>% mutate(day = as.numeric(as.character(day))) %>% arrange(day,abs_reads) %>% mutate(day = as.factor(day))
library('ggdendro')
library('grid')
set.seed(123)
jax.cohoused <- norm_zotu %>% filter(tx_group == 'Jax Cohoused') %>%
group_by(day, OTU) %>% filter(OTU != 'Otu1') %>%
summarise(mean_log10abs_rel_abundance = mean(log10abs_rel_abundance)) %>%
select(OTU, day, mean_log10abs_rel_abundance) %>% distinct() %>% reshape2::dcast(OTU~day)
jax.cohoused.scaled <- jax.cohoused
jax.cohoused.scaled[, c(2:13)] <- (jax.cohoused.scaled[, 2:13]) #don't scale here actually
#clustering
jax.cohoused.matrix <- as.matrix(jax.cohoused.scaled[, -c(1)])
rownames(jax.cohoused.matrix) <- jax.cohoused.scaled$OTU
jax.cohoused.dendro <- as.dendrogram(hclust(d = dist(x = jax.cohoused.matrix)))
# Create dendro
dendro.plot <- ggdendrogram(data = jax.cohoused.dendro, rotate = TRUE)
# Preview the plot
print(dendro.plot)
##Heatmap
jax.cohoused.long <- reshape2::melt(jax.cohoused.scaled, id = c("OTU"))
heatmap.plot <- ggplot(data = jax.cohoused.long, aes(x = variable, y = OTU)) +
geom_tile(aes(fill = value)) +
scale_fill_gradient2() +
theme(axis.text.y = element_text(size = 6))
#print(heatmap.plot)
#Add phylogenetic tree
#grid.newpage()
#print(heatmap.plot, vp = viewport(x = 0.4, y = 0.5, width = 0.8, height = 1.0))
#print(dendro.plot, vp = viewport(x = 0.90, y = 0.445, width = 0.2, height = 1.0))
#reorder
jax.cohoused.order <- order.dendrogram(jax.cohoused.dendro)
jax.cohoused.long <- left_join(jax.cohoused.long, gtable)
jax.cohoused.long$OTU <- factor(x = jax.cohoused.long$OTU,
levels = jax.cohoused.scaled$OTU[jax.cohoused.order],
ordered = TRUE)
bugColors <- setNames(c(scales::hue_pal()(length(unique(jax.cohoused.long$family)))), c(levels(as.factor(jax.cohoused.long$family))))
# Heatmap
heatmap.plot <- ggplot(data = jax.cohoused.long, aes(x = variable, y = OTU)) +
geom_tile(aes(fill = value), color = 'white') +
#scale_fill_gradientn(colours = pal, limits = c(-5,-.5)) +
scale_fill_gradient2(high = 'firebrick3', mid = 'white', low = '#1357a6', midpoint = -3) +
labs(x='Day', fill ='Relative Abundance') +
theme(strip.text.y.right = element_text(angle = 0),
panel.background = element_rect(fill = "white"),
axis.ticks = element_blank(),
axis.title.y = element_blank(),
#             axis.text.y = element_blank(),
axis.text.x = element_text(size = 10),
strip.text = element_text(size = 10),
panel.spacing = unit(0.05, "lines"),
legend.position = 'bottom')
heatmap.plot
fam <- ggplot(data = jax.cohoused.long, aes(x = '', y = OTU)) +
geom_tile(aes(fill = family), color = 'white') +
labs(fill = 'Family') +
theme(strip.text.y.right = element_text(angle = 0),
panel.background = element_rect(fill = "white"),
axis.ticks = element_blank(),
axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
axis.title.x = element_blank(),
strip.text = element_blank(),
panel.spacing = unit(0.05, "lines"))
#Now look at envigo D0
envigo <- norm_zotu %>% filter(tx_group == 'Envigo Control' & day == 1) %>%
group_by(day, OTU) %>% filter(OTU %in% jax.cohoused.long$OTU) %>%
summarise(mean_log10abs_rel_abundance = mean(log10abs_rel_abundance))
envigo$OTU <- factor(x = envigo$OTU,
levels = jax.cohoused.scaled$OTU[jax.cohoused.order],
ordered = TRUE)
env <- ggplot(data = envigo, aes(x = '', y = OTU)) +
geom_tile(aes(fill = mean_log10abs_rel_abundance)) +
#scale_fill_gradientn(colours = pal, limits = c(-5,-.5)) +
scale_fill_gradient2(high = 'firebrick3', mid = 'white', low = '#1357a6', midpoint = -3) +
labs(x='Envigo', fill ='Relative Abundance') +
theme(strip.text.y.right = element_text(angle = 0),
panel.background = element_rect(fill = "white"),
axis.ticks = element_blank(),
axis.text.y = element_blank(),
#axis.title.y = element_blank(),
axis.text.x = element_blank(),
#axis.title.x = element_blank(),
strip.text = element_blank(),
panel.spacing = unit(0.05, "lines"),
legend.position = 'none')
#Also add early colonizer/late colonizer row
# coltype <- full_join((jax.cohoused.long %>% filter(variable == '0') %>% mutate(d0_abd = 10^value) %>% select(OTU, d0_abd)),
#   (jax.cohoused.long %>% filter(variable == '5') %>% mutate(d5_abd = 10^value) %>% select(OTU, d5_abd))) %>%
#     full_join(.,
#   (jax.cohoused.long %>% filter(variable == '32') %>% mutate(d32_abd = 10^value) %>% select(OTU, d32_abd))) %>%
#   mutate(colonizer_type = ifelse(d32_abd/d0_abd > 10, 2, 0),
#          colonizer_type = ifelse(d5_abd/d0_abd > 10, 1, colonizer_type))%>%
#get colonizer type from DEseq
coltype <- left_join(jax.cohoused.long, read.csv("../tables/colonizer_order.txt")) %>% replace(is.na(.), 'Unstable')
coltype$OTU <- factor(x = coltype$OTU,
levels = jax.cohoused.scaled$OTU[jax.cohoused.order],
ordered = TRUE)
type_graph <- ggplot(coltype, aes(x = '', y = OTU)) +
geom_tile(aes(fill = as.factor(colonizer_type))) +
scale_fill_manual(values = c('#fbb03b', '#ff0000','#fcee21', 'black')) +
labs(fill = 'Colonizer Type') +
theme(strip.text.y.right = element_text(angle = 0),
panel.background = element_rect(fill = "white"),
axis.ticks = element_blank(),
axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
axis.title.x = element_blank(),
strip.text = element_blank(),
panel.spacing = unit(0.05, "lines"))
type_graph
cowplot::plot_grid(env, heatmap.plot, fam, type_graph, ncol =4, rel_widths = c(.1,.6,.2, .2))
ggsave("../figs/fig3/Longitudinal_FMT.png",  width = 12, height = 5)
ggsave("../figs/fig3/Longitudinal_FMT.pdf",  width = 12, height = 5)
#Colonizer dataframe for later?
#full_join((jax.cohoused.long %>% filter(variable == '0') %>% mutate(d0_abd = 10^value) %>% select(OTU, d0_abd)),
#  (jax.cohoused.long %>% filter(variable == '5') %>% mutate(d5_abd = 10^value) %>% select(OTU, d5_abd))) %>%
#    full_join(.,
#  (jax.cohoused.long %>% filter(variable == '32') %>% mutate(d32_abd = 10^value) %>% select(OTU, d32_abd))) %>%
#  mutate(colonizer_type = ifelse(d32_abd/d0_abd > 10, "late", "non"),
#         colonizer_type = ifelse(d5_abd/d0_abd > 10, "early", colonizer_type)) %>%
#  select(OTU, colonizer_type) %>%
#  write.csv(., "../tables/colonizer_order.txt", quote = F, row.names = F)
View(jax.cohoused)
write.csv(jax.cohoused, "~/Desktop/DZ_timeseries.csv", quote = F, row.names = F)
